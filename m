Return-Path: <ltp-bounces+lists+linux-ltp=lfdr.de@lists.linux.it>
X-Original-To: lists+linux-ltp@lfdr.de
Delivered-To: lists+linux-ltp@lfdr.de
Received: from picard.linux.it (picard.linux.it [213.254.12.146])
	by mail.lfdr.de (Postfix) with ESMTPS id 77C823E24D7
	for <lists+linux-ltp@lfdr.de>; Fri,  6 Aug 2021 10:14:28 +0200 (CEST)
Received: from picard.linux.it (localhost [IPv6:::1])
	by picard.linux.it (Postfix) with ESMTP id D08643C7AF4
	for <lists+linux-ltp@lfdr.de>; Fri,  6 Aug 2021 10:14:27 +0200 (CEST)
X-Original-To: ltp@lists.linux.it
Delivered-To: ltp@picard.linux.it
Received: from in-7.smtp.seeweb.it (in-7.smtp.seeweb.it [217.194.8.7])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
 key-exchange X25519 server-signature RSA-PSS (2048 bits))
 (No client certificate requested)
 by picard.linux.it (Postfix) with ESMTPS id 3A9353C03FF
 for <ltp@lists.linux.it>; Fri,  6 Aug 2021 10:14:24 +0200 (CEST)
Received: from mail.jv-coder.de (mail.jv-coder.de [5.9.79.73])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
 key-exchange X25519 server-signature RSA-PSS (2048 bits) server-digest SHA256)
 (No client certificate requested)
 by in-7.smtp.seeweb.it (Postfix) with ESMTPS id 72C2F201084
 for <ltp@lists.linux.it>; Fri,  6 Aug 2021 10:14:23 +0200 (CEST)
Received: from [192.168.178.40] (unknown [188.192.255.100])
 by mail.jv-coder.de (Postfix) with ESMTPSA id 3638C9F69E;
 Fri,  6 Aug 2021 08:14:22 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=jv-coder.de; s=dkim;
 t=1628237662; bh=ELY9nLT0c9B0DHbgUBaJ7LjYyGgID1WwjJEcWojTjnQ=;
 h=Subject:To:From:Message-ID:Date:MIME-Version;
 b=p6mPb+b53Beg///YHLViiYKSTwkP7IchOpZxZJUbgqABjMbJSgCViaOWuvr2/RrBp
 LZUJ7y7f8v/H52PVlqOLvQ8KWnSH3tqEwPSrlROOm1s4P3UhO3MgjFKiYErvacl97U
 GbB1HBVx0AKJIwvQleSUw+RXj0vW1xvVQIOjCKWY=
To: Petr Vorel <pvorel@suse.cz>, Bogdan Lezhepekov <bogdan.lezhepekov@suse.com>
References: <20210805140806.3884-1-bogdan.lezhepekov@suse.com>
 <YQzpXHDvFmoaSFhi@pevik>
From: Joerg Vehlow <lkml@jv-coder.de>
Message-ID: <bb73135b-4ee3-71c3-5442-bf39064b3534@jv-coder.de>
Date: Fri, 6 Aug 2021 10:14:22 +0200
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:78.0) Gecko/20100101
 Thunderbird/78.12.0
MIME-Version: 1.0
In-Reply-To: <YQzpXHDvFmoaSFhi@pevik>
Content-Language: en-US
X-Spam-Status: No, score=-2.5 required=7.0 tests=DKIM_SIGNED,DKIM_VALID,
 DKIM_VALID_AU,DKIM_VALID_EF,NICE_REPLY_A,SPF_HELO_NONE,SPF_PASS
 autolearn=disabled version=3.4.4
X-Spam-Checker-Version: SpamAssassin 3.4.4 (2020-01-24) on in-7.smtp.seeweb.it
X-Virus-Scanned: clamav-milter 0.102.4 at in-7.smtp.seeweb.it
X-Virus-Status: Clean
Subject: Re: [LTP] [PATCH v1] connectors/cn_pec: improve reliability
X-BeenThere: ltp@lists.linux.it
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Linux Test Project <ltp.lists.linux.it>
List-Unsubscribe: <https://lists.linux.it/options/ltp>,
 <mailto:ltp-request@lists.linux.it?subject=unsubscribe>
List-Archive: <http://lists.linux.it/pipermail/ltp/>
List-Post: <mailto:ltp@lists.linux.it>
List-Help: <mailto:ltp-request@lists.linux.it?subject=help>
List-Subscribe: <https://lists.linux.it/listinfo/ltp>,
 <mailto:ltp-request@lists.linux.it?subject=subscribe>
Cc: ltp@lists.linux.it
Content-Transfer-Encoding: 7bit
Content-Type: text/plain; charset="us-ascii"; Format="flowed"
Errors-To: ltp-bounces+lists+linux-ltp=lfdr.de@lists.linux.it
Sender: "ltp" <ltp-bounces+lists+linux-ltp=lfdr.de@lists.linux.it>

Hi Petr,

On 8/6/2021 9:48 AM, Petr Vorel wrote:
>
> If I understand the code correctly, pec_listener keeps receiving msg from PEC
> until got signaled by kill. We generally try to avoid sleep in tests [1].
>
> @Joerg: I'm not sure if it's reasonable to add another signal handler in which
> pec_listener would print number of already handled requests (with write() as
> printf() is not reentrant). Then we could loop for certain time before sending INT.
>
The problem is, that it is hard to know, if all expected events were 
received. pec_listener receives events from all processes.
The only way to reliably handle the issue without sleeping is tracking 
exit-events in pec_listener and to tell it to die, once it received an 
exit event from event_generator.
Only then we can be sure, that all events generated by the generator 
(and hopefully all it's children) were received.

We could also get rid of the other sleep (after starting the listener 
using some kind of synchronization (I guess right after 
PROC_CN_MCAST_LISTEN should work). I think checkpoints are not part of 
the new lib...

Joerg

-- 
Mailing list info: https://lists.linux.it/listinfo/ltp
