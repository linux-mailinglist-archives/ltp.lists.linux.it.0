Return-Path: <ltp-bounces+lists+linux-ltp=lfdr.de@lists.linux.it>
X-Original-To: lists+linux-ltp@lfdr.de
Delivered-To: lists+linux-ltp@lfdr.de
Received: from picard.linux.it (picard.linux.it [IPv6:2001:1418:10:5::2])
	by mail.lfdr.de (Postfix) with ESMTPS id 0BCF332A413
	for <lists+linux-ltp@lfdr.de>; Tue,  2 Mar 2021 16:29:04 +0100 (CET)
Received: from picard.linux.it (localhost [IPv6:::1])
	by picard.linux.it (Postfix) with ESMTP id D2BAF3C7B4B
	for <lists+linux-ltp@lfdr.de>; Tue,  2 Mar 2021 16:29:03 +0100 (CET)
X-Original-To: ltp@lists.linux.it
Delivered-To: ltp@picard.linux.it
Received: from in-4.smtp.seeweb.it (in-4.smtp.seeweb.it
 [IPv6:2001:4b78:1:20::4])
 by picard.linux.it (Postfix) with ESMTP id 597273C6166
 for <ltp@lists.linux.it>; Tue,  2 Mar 2021 16:27:58 +0100 (CET)
Received: from mx2.suse.de (mx2.suse.de [195.135.220.15])
 (using TLSv1.2 with cipher AECDH-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by in-4.smtp.seeweb.it (Postfix) with ESMTPS id 452841007CB1
 for <ltp@lists.linux.it>; Tue,  2 Mar 2021 16:27:56 +0100 (CET)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=suse.com; s=susede1;
 t=1614698875; h=from:from:reply-to:date:date:message-id:message-id:to:to:cc:cc:
 mime-version:mime-version:content-type:content-type:
 content-transfer-encoding:content-transfer-encoding:
 in-reply-to:in-reply-to:references:references;
 bh=ul8vNCa9HAgL73UC3JXDWU7nPSR7A0BD0Up0k6AI8MY=;
 b=Kr4V/fj8R1lflSOXKgft+Sqmsuphb9aanuzbn/rlvtrhfruLNQd7voJ38F6CffGEcebU+o
 az/j2vix7RQfztW425YwFUznt9ZvFg03X//88MecAqc34UjueCQmPD6bRyVi9rTcxhSxpm
 ErmnDBujPSY3kvG8AZQBVkmTdm5VPjw=
Received: from relay2.suse.de (unknown [195.135.221.27])
 by mx2.suse.de (Postfix) with ESMTP id BC1CCAE3C;
 Tue,  2 Mar 2021 15:27:55 +0000 (UTC)
To: ltp@lists.linux.it
Date: Tue,  2 Mar 2021 15:25:06 +0000
Message-Id: <20210302152510.15116-4-rpalethorpe@suse.com>
X-Mailer: git-send-email 2.30.0
In-Reply-To: <20210302152510.15116-1-rpalethorpe@suse.com>
References: <20210302152510.15116-1-rpalethorpe@suse.com>
MIME-Version: 1.0
X-Virus-Scanned: clamav-milter 0.102.4 at in-4.smtp.seeweb.it
X-Virus-Status: Clean
X-Spam-Status: No, score=0.1 required=7.0 tests=DKIM_SIGNED,DKIM_VALID,
 DKIM_VALID_AU,DKIM_VALID_EF,SPF_HELO_NONE,SPF_PASS autolearn=disabled
 version=3.4.4
X-Spam-Checker-Version: SpamAssassin 3.4.4 (2020-01-24) on in-4.smtp.seeweb.it
Subject: [LTP] [RFC PATCH v2 3/7] Add new CGroups Core and Item APIs
X-BeenThere: ltp@lists.linux.it
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Linux Test Project <ltp.lists.linux.it>
List-Unsubscribe: <https://lists.linux.it/options/ltp>,
 <mailto:ltp-request@lists.linux.it?subject=unsubscribe>
List-Archive: <http://lists.linux.it/pipermail/ltp/>
List-Post: <mailto:ltp@lists.linux.it>
List-Help: <mailto:ltp-request@lists.linux.it?subject=help>
List-Subscribe: <https://lists.linux.it/listinfo/ltp>,
 <mailto:ltp-request@lists.linux.it?subject=subscribe>
From: Richard Palethorpe via ltp <ltp@lists.linux.it>
Reply-To: Richard Palethorpe <rpalethorpe@suse.com>
Cc: Richard Palethorpe <rpalethorpe@suse.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: ltp-bounces+lists+linux-ltp=lfdr.de@lists.linux.it
Sender: "ltp" <ltp-bounces+lists+linux-ltp=lfdr.de@lists.linux.it>

Q29tcGxldGUgcmV3cml0ZSBvZiB0aGUgQ0dyb3VwcyBBUEkgd2hpY2ggcHJvdmlkZXMgdHdvIGxh
eWVycyBvZgppbmRpcmVjdGlvbiBiZXR3ZWVuIHRoZSB0ZXN0IGF1dGhvciBhbmQgdGhlIFNVVCdz
IENHcm91cApjb25maWd1cmF0aW9uLgoKU2lnbmVkLW9mZi1ieTogUmljaGFyZCBQYWxldGhvcnBl
IDxycGFsZXRob3JwZUBzdXNlLmNvbT4KLS0tCiBpbmNsdWRlL3RzdF9jZ3JvdXAuaCAgICAgIHwg
IDEyNCArKy0tCiBpbmNsdWRlL3RzdF9jZ3JvdXBfY29yZS5oIHwgICA1OCArKwogaW5jbHVkZS90
c3RfY2dyb3VwX2l0ZW0uaCB8ICAxMzkgKysrKwogaW5jbHVkZS90c3RfdGVzdC5oICAgICAgICB8
ICAgIDEgLQogbGliL3RzdF9jZ3JvdXAuYyAgICAgICAgICB8IDEyNTggKysrKysrKysrKysrKysr
KysrKysrKysrKysrLS0tLS0tLS0tLQogNSBmaWxlcyBjaGFuZ2VkLCAxMjI0IGluc2VydGlvbnMo
KyksIDM1NiBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBpbmNsdWRlL3RzdF9jZ3Jv
dXBfY29yZS5oCiBjcmVhdGUgbW9kZSAxMDA2NDQgaW5jbHVkZS90c3RfY2dyb3VwX2l0ZW0uaAoK
ZGlmZiAtLWdpdCBhL2luY2x1ZGUvdHN0X2Nncm91cC5oIGIvaW5jbHVkZS90c3RfY2dyb3VwLmgK
aW5kZXggYmZkODQ4MjYwLi4zMjYzNTM3YzIgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvdHN0X2Nncm91
cC5oCisrKyBiL2luY2x1ZGUvdHN0X2Nncm91cC5oCkBAIC0yLDQ2ICsyLDk4IEBACiAvKgogICog
Q29weXJpZ2h0IChjKSAyMDIwIFJlZCBIYXQsIEluYy4KICAqIENvcHlyaWdodCAoYykgMjAyMCBM
aSBXYW5nIDxsaXdhbmdAcmVkaGF0LmNvbT4KKyAqIENvcHlyaWdodCAoYykgMjAyMC0yMDIxIFNV
U0UgTExDIDxycGFsZXRob3JwZUBzdXNlLmNvbT4KICAqLworLypcCisgKiBbREVTQ1JJUFRJT05d
CisgKgorICogVGhlIExUUCBDb250cm9sIEdyb3VwcyBsaWJyYXJ5IGNhbiBiZSBzZXBlcmF0ZWQg
aW50byB0d28gcGFydHMuCisgKiAtIENHcm91cCBDb3JlCisgKiAtIENHcm91cCBJdGVtCisgKgor
ICogVGhlIENHcm91cCBDb3JlIGlzIHdoZXJlIHdlIHNjYW4gdGhlIGN1cnJlbnQgc3lzdGVtLCBi
dWlsZCBhIG1vZGVsCisgKiBvZiB0aGUgY3VycmVudCBDR3JvdXAgY29uZmlndXJhdGlvbiwgdGhl
biBhZGQgbWlzc2luZyBjb25maWd1cmF0aW9uCisgKiBuZWNlc3NhcnkgZm9yIHRoZSBMVFAgb3Ig
Z2l2ZSB1cC4gT25jZSB0ZXN0aW5nIGlzIGZpbmlzaGVkIGl0IHRoZW4KKyAqIGFsc28gYXR0ZW1w
dHMgY2xlYW51cC4KKyAqCisgKiBUaGUgQ0dyb3VwIEl0ZW0gaW50ZXJmYWNlIGlzIG1vc3RseSB3
aGF0IHRoZSB0ZXN0IGF1dGhvciBpbnRlcmFjdHMKKyAqIHdpdGguIEl0IG1pcnJvcnMgdGhlIENH
cm91cHMgVjIgKHVuaWZpZWQpIGtlcm5lbCBBUEkuIFNvIGV2ZW4gaWYKKyAqIHRoZSBzeXN0ZW0g
aGFzIHNvbWUgbmFzdHkgVjEgY29uZmlndXJhdGlvbiwgdGhlIHRlc3QgYXV0aG9yIG1heQorICog
d3JpdGUgdGhlaXIgY29kZSBhcyBpZiBmb3IgVjIgKHdpdGggZXhjZXB0aW9ucykuIEl0IGJ1aWxk
cyBvbiB0aGUKKyAqIG1vZGVsIGNyZWF0ZWQgYnkgQ0dyb3VwIENvcmUuCisgKgorICogWW91IG1h
eSBhc2s7ICJXaHkgZG9uJ3QgeW91IGp1c3QgbW91bnQgYSBzaW1wbGUgQ0dyb3VwIGhpZXJhcmNo
eSwKKyAqIGluc3RlYWQgb2Ygc2Nhbm5pbmcgdGhlIGN1cnJlbnQgc2V0dXA/Ii4gVGhlIHNob3J0
IGFuc3dlciBpcyB0aGF0CisgKiBpdCBpcyBub3QgcG9zc2libGUgdW5sZXNzIG5vIENHcm91cHMg
YXJlIGN1cnJlbnRseSBhY3RpdmUgYW5kCisgKiBhbG1vc3QgYWxsIG9mIG91ciB1c2VycyB3aWxs
IGhhdmUgQ0dyb3VwcyBhY3RpdmUuIEV2ZW4gaWYKKyAqIHVubW91bnRpbmcgdGhlIGN1cnJlbnQg
Q0dyb3VwIGhpZXJhcmNoeSBpcyBhIHJlYXNvbmFibGUgdGhpbmcgdG8gZG8KKyAqIHRvIHRoZSBz
eXRlbSBtYW5hZ2VyLCBpdCBpcyBoaWdobHkgdW5saWtlbHkgdGhlIENHcm91cCBoaWVyYXJjaHkK
KyAqIHdpbGwgYmUgZGVzdHJveWVkLiBTbyB1c2VycyB3b3VsZCBiZSBmb3JjZWQgdG8gcmVtb3Zl
IHRoZWlyIENHcm91cAorICogY29uZmlndXJhdGlvbiBhbmQgcmVib290IHRoZSBzeXN0ZW0uCisg
KgorICogVGhlIGNvcmUgbGlicmFyeSB0cmllcyB0byBlbnN1cmUgYW4gTFRQIENHcm91cCBleGlz
dHMgb24gZWFjaAorICogaGllcmFyY2h5IHJvb3QuIEluc2lkZSB0aGUgTFRQIGdyb3VwIGl0IGVu
c3VyZXMgYSAnZHJhaW4nIGdyb3VwCisgKiBleGlzdHMgYW5kIGNyZWF0cyBhIHRlc3QgZ3JvdXAg
Zm9yIHRoZSBjdXJyZW50IHRlc3QuIEluIHRoZSB3b3JzdAorICogY2FzZSB3ZSBlbmQgdXAgd2l0
aCBhIHNldCBvZiBoaWVyYXJjaGllcyBsaWtlIHRoZSBmb2xsd29pbmcuIFdoZXJlCisgKiBleGlz
dGluZyBzeXN0ZW0gbWFuYWdlciBjcmVhdGVkIENHcm91cHMgaGF2ZSBiZWVuIG9taXR0ZWQuCisg
KgorICogCShWMiBSb290KQkoVjEgUm9vdCAxKQkuLi4JKFYxIFJvb3QgTikKKyAqIAkgICAgfAkJ
ICAgICB8CQkJICAgICB8CisgKgkgIChsdHApCQkgICAobHRwKQkuLi4JICAgKGx0cCkKKyAqCSAv
ICAgICBcCSAgLwlcCQkgIC8JXAorICogIChkcmFpbikgKHRlc3QtbikgKGRyYWluKSAgKHRlc3Qt
bikgIC4uLiAgKGRyYWluKSAgKHRlc3QtbikKKyAqCisgKiBWMiBDR3JvdXAgY29udHJvbGxlcnMg
dXNlIGEgc2luZ2xlIHVuaWZpZWQgaGllcmFyY2h5IG9uIGEgc2luZ2xlCisgKiByb290LiBUd28g
b3IgbW9yZSBWMSBjb250cm9sbGVycyBtYXkgc2hhcmUgYSByb290IG9yIGhhdmUgdGhlaXIgb3du
CisgKiByb290LiBIb3dldmVyIHRoZXJlIG1heSBleGlzdCBvbmx5IG9uZSBpbnN0YW5jZSBvZiBh
IGNvbnRyb2xsZXIuCisgKiBTbyB5b3UgY2FuIG5vdCBoYXZlIHRoZSBzYW1lIFYxIGNvbnRyb2xs
ZXIgb24gbXVsdGlwbGUgcm9vdHMuCisgKgorICogSXQgaXMgcG9zc2libGUgdG8gaGF2ZSBib3Ro
IGEgVjIgaGllcmFyY2h5IGFuZCBWMSBoaWVyYXJjaGllcworICogYWN0aXZlIGF0IHRoZSBzYW1l
IHRpbWUuIFdoaWNoIGlzIHdoYXQgaXMgc2hvd24gYWJvdmUuIEFueQorICogY29udHJvbGxlcnMg
YXR0YWNoZWQgdG8gVjEgaGllcmFyY2hpZXMgd2lsbCBub3QgYmUgYXZhaWxhYmxlIGluIHRoZQor
ICogVjIgaGllcmFyY2h5LiBUaGUgcmV2ZXJzZSBpcyBhbHNvIHRydWUuCisgKgorICogTm90ZSB0
aGF0IGEgc2luZ2xlIGhpZXJhcmNoeSBtYXkgYmUgbW91bnRlZCBtdWx0aXBsZQorICogdGltZXMu
IEFsbG93aW5nIGl0IHRvIGJlIGFjY2Vzc2VkIGF0IGRpZmZlcmVudCBsb2NhdGlvbnMuIEhvd2V2
ZXIKKyAqIHN1YnNlcXVlbnQgbW91bnQgb3BlcmF0aW9ucyB3aWxsIGZhaWwgaWYgdGhlIG1vdW50
IG9wdGlvbnMgYXJlCisgKiBkaWZmZXJlbnQgZnJvbSB0aGUgZmlyc3QuCisgKgorICogVGhlIHVz
ZXIgbWF5IHByZS1jcmVhdGUgdGhlIENHcm91cCBoaWVyYXJjaGllcyBhbmQgdGhlIGx0cCBDR3Jv
dXAsCisgKiBvdGhlcndpc2UgdGhlIGxpYnJhcnkgd2lsbCB0cnkgdG8gY3JlYXRlIHRoZW0uIElm
IHRoZSBsdHAgZ3JvdXAKKyAqIGFscmVhZHkgZXhpc3RzIGFuZCBoYXMgYXBwcm9wcmlhdGUgcGVy
bWlzc2lvbnMsIHRoZW4gYWRtaW4KKyAqIHByaXZpbGVnZXMgd2lsbCBub3QgYmUgcmVxdWlyZWQg
dG8gcnVuIHRoZSB0ZXN0cy4KKyAqCisgKiBCZWNhdXNlIHRoZSB0ZXN0IG1heSBub3QgaGF2ZSBh
Y2Nlc3MgdG8gdGhlIENHcm91cCByb290KHMpLCB0aGUKKyAqIGRyYWluIENHcm91cCBpcyBjcmVh
dGVkLiBUaGlzIGNhbiBiZSB1c2VkIHRvIHN0b3JlIHByb2Nlc3NlcyB3aGljaAorICogd291bGQg
b3RoZXJ3aXNlIGJsb2NrIHRoZSBkZXN0cnVjdGlvbiBvZiB0aGUgaW5kaXZpZHVhbCB0ZXN0IENH
cm91cAorICogb3Igb25lIG9mIGl0cyBkZXNjZW5kYW50cy4KKyAqCisgKiBUaGUgdGVzdCBhdXRo
b3IgbWF5IGNyZWF0ZSBjaGlsZCBDR3JvdXBzIHdpdGhpbiB0aGUgdGVzdCBDR3JvdXAKKyAqIHVz
aW5nIHRoZSBDR3JvdXAgSXRlbSBBUEkuIFRoZSBsaWJyYXJ5IHdpbGwgY3JlYXRlIHRoZSBuZXcg
Q0dyb3VwCisgKiBpbiBhbGwgdGhlIHJlbGV2YW50IGhpZXJhcmNoaWVzLgorICoKKyAqIFRoZXJl
IGFyZSBtYW55IGRpZmZlcmVuY2VzIGJldHdlZW4gdGhlIFYxIGFuZCBWMiBDR3JvdXAgQVBJcy4g
SWYgYQorICogY29udHJvbGxlciBpcyBvbiBib3RoIFYxIGFuZCBWMiwgaXQgbWF5IGhhdmUgZGlm
ZmVyZW50IHBhcmFtZXRlcnMKKyAqIGFuZCBjb250cm9sIGZpbGVzLiBTb21lIG9mIHRoZXNlIGNv
bnRyb2wgZmlsZXMgaGF2ZSBhIGRpZmZlcmVudAorICogbmFtZSwgYnV0IHRoZSBzYW1lIGZ1bmN0
aW9uYWxpdHkuIEluIHRoaXMgY2FzZSB0aGUgSXRlbSBBUEkgdXNlcworICogdGhlIFYyIG5hbWVz
IGFuZCBhbGlhc2VzIHRoZW0gdG8gdGhlIFYxIG5hbWUgd2hlbiBhcHByb3ByaWF0ZS4KKyAqCisg
KiBTb21lIGNvbnRyb2wgZmlsZXMgb25seSBleGlzdCBvbiBvbmUgb2YgdGhlIHZlcnNpb25zIG9y
IHRoZXkgY2FuIGJlCisgKiBtaXNzaW5nIGR1ZSB0byBvdGhlciByZWFzb25zLiBUaGUgSXRlbSBB
UEkgYWxsb3dzIHRoZSB1c2VyIHRvIGNoZWNrCisgKiBpZiB0aGUgZmlsZSBleGlzdHMgYmVmb3Jl
IHRyeWluZyB0byB1c2UgaXQuCisgKgorICogSW4gc29tZSBjYXNlcyBhIGNvbnRyb2wgZmlsZSBo
YXMgYWxtb3N0IHRoZSBzYW1lIGZ1bmN0aW9uYWxpdHkKKyAqIGJldHdlZW4gVjEgYW5kIFYyLiBX
aGljaCBtZWFucyBpdCBjYW4gYmUgdXNlZCBpbiB0aGUgc2FtZSB3YXkgbW9zdAorICogb2YgdGhl
IHRpbWUsIGJ1dCBub3QgYWxsLiBGb3Igbm93IHRoaXMgaXMgaGFuZGxlZCBieSBleHBvc2luZyB0
aGUKKyAqIEFQSSB2ZXJzaW9uIGEgY29udHJvbGxlciBpcyB1c2luZyB0byBhbGxvdyB0aGUgdGVz
dCBhdXRob3IgdG8KKyAqIGhhbmRsZSBlZGdlIGNhc2VzLiAoZS5nLiBWMiBtZW1vcnkuc3dhcC5t
YXggYWNjZXB0cyAibWF4IiwgYnV0IFYxCisgKiBtZW1vcnkubWVtc3cubGltaXRfaW5fYnl0ZXMg
ZG9lcyBub3QpLgorXCovCiAKICNpZm5kZWYgVFNUX0NHUk9VUF9ICiAjZGVmaW5lIFRTVF9DR1JP
VVBfSAogCi0jZGVmaW5lIFBBVEhfVE1QX0NHX01FTQkiL3RtcC9jZ3JvdXBfbWVtIgotI2RlZmlu
ZSBQQVRIX1RNUF9DR19DU1QJIi90bXAvY2dyb3VwX2NzdCIKLQotZW51bSB0c3RfY2dyb3VwX3Zl
ciB7Ci0JVFNUX0NHUk9VUF9WMSA9IDEsCi0JVFNUX0NHUk9VUF9WMiA9IDIsCi19OwotCi1lbnVt
IHRzdF9jZ3JvdXBfY3RybCB7Ci0JVFNUX0NHUk9VUF9NRU1DRyA9IDEsCi0JVFNUX0NHUk9VUF9D
UFVTRVQgPSAyLAotCS8qIGFkZCBjZ3JvdXAgY29udHJvbGxlciAqLwotfTsKLQotZW51bSB0c3Rf
Y2dyb3VwX3ZlciB0c3RfY2dyb3VwX3ZlcnNpb24odm9pZCk7Ci0KLS8qIFRvIG1vdW50L3Vtb3Vu
dCBzcGVjaWZpZWQgY2dyb3VwIGNvbnRyb2xsZXIgb24gJ2Nncm91cF9kaXInIHBhdGggKi8KLXZv
aWQgdHN0X2Nncm91cF9tb3VudChlbnVtIHRzdF9jZ3JvdXBfY3RybCBjdHJsLCBjb25zdCBjaGFy
ICpjZ3JvdXBfZGlyKTsKLXZvaWQgdHN0X2Nncm91cF91bW91bnQoY29uc3QgY2hhciAqY2dyb3Vw
X2Rpcik7Ci0KLS8qIFRvIG1vdmUgY3VycmVudCBwcm9jZXNzIFBJRCB0byB0aGUgbW91bnRlZCBj
Z3JvdXAgdGFza3MgKi8KLXZvaWQgdHN0X2Nncm91cF9tb3ZlX2N1cnJlbnQoY29uc3QgY2hhciAq
Y2dyb3VwX2Rpcik7Ci0KLS8qIFRvIHNldCBjZ3JvdXAgY29udHJvbGxlciBrbm9iIHdpdGggbmV3
IHZhbHVlICovCi12b2lkIHRzdF9jZ3JvdXBfc2V0X2tub2IoY29uc3QgY2hhciAqY2dyb3VwX2Rp
ciwgY29uc3QgY2hhciAqa25vYiwgbG9uZyB2YWx1ZSk7Ci0KLS8qIFNldCBvZiBmdW5jdGlvbnMg
dG8gc2V0IGtub2JzIHVuZGVyIHRoZSBtZW1vcnkgY29udHJvbGxlciAqLwotdm9pZCB0c3RfY2dy
b3VwX21lbV9zZXRfbWF4Ynl0ZXMoY29uc3QgY2hhciAqY2dyb3VwX2RpciwgbG9uZyBtZW1zeik7
Ci1pbnQgIHRzdF9jZ3JvdXBfbWVtX3N3YXBhY2N0X2VuYWJsZWQoY29uc3QgY2hhciAqY2dyb3Vw
X2Rpcik7Ci12b2lkIHRzdF9jZ3JvdXBfbWVtX3NldF9tYXhzd2FwKGNvbnN0IGNoYXIgKmNncm91
cF9kaXIsIGxvbmcgbWVtc3opOwotCi0vKiBTZXQgb2YgZnVuY3Rpb25zIHRvIHJlYWQvd3JpdGUg
Y3B1c2V0IGNvbnRyb2xsZXIgZmlsZXMgY29udGVudCAqLwotdm9pZCB0c3RfY2dyb3VwX2NwdXNl
dF9yZWFkX2ZpbGVzKGNvbnN0IGNoYXIgKmNncm91cF9kaXIsIGNvbnN0IGNoYXIgKmZpbGVuYW1l
LAotCWNoYXIgKnJldGJ1Ziwgc2l6ZV90IHJldGJ1Zl9zeik7Ci12b2lkIHRzdF9jZ3JvdXBfY3B1
c2V0X3dyaXRlX2ZpbGVzKGNvbnN0IGNoYXIgKmNncm91cF9kaXIsIGNvbnN0IGNoYXIgKmZpbGVu
YW1lLAotCWNvbnN0IGNoYXIgKmJ1Zik7CisjaW5jbHVkZSAidHN0X2Nncm91cF9jb3JlLmgiCisj
aW5jbHVkZSAidHN0X2Nncm91cF9pdGVtLmgiCiAKICNlbmRpZiAvKiBUU1RfQ0dST1VQX0ggKi8K
ZGlmZiAtLWdpdCBhL2luY2x1ZGUvdHN0X2Nncm91cF9jb3JlLmggYi9pbmNsdWRlL3RzdF9jZ3Jv
dXBfY29yZS5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMC4uMDBjMWI2Zjg0
Ci0tLSAvZGV2L251bGwKKysrIGIvaW5jbHVkZS90c3RfY2dyb3VwX2NvcmUuaApAQCAtMCwwICsx
LDU4IEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMC1vci1sYXRlcgorLyoK
KyAqIENvcHlyaWdodCAoYykgMjAyMC0yMDIxIFNVU0UgTExDIDxycGFsZXRob3JwZUBzdXNlLmNv
bT4KKyAqLworI2lmbmRlZiBUU1RfQ0dST1VQX0NPUkVfSAorI2RlZmluZSBUU1RfQ0dST1VQX0NP
UkVfSAorCitlbnVtIHRzdF9jZ3JvdXBfdmVyIHsKKwlUU1RfQ0dST1VQX1YxID0gMSwKKwlUU1Rf
Q0dST1VQX1YyID0gMiwKK307CisKK2VudW0gdHN0X2Nncm91cF9jdHJsIHsKKwlUU1RfQ0dST1VQ
X01FTU9SWSA9IDEsCisJVFNUX0NHUk9VUF9DUFVTRVQgPSAyLAorfTsKKyNkZWZpbmUgVFNUX0NH
Uk9VUF9NQVggVFNUX0NHUk9VUF9DUFVTRVQKKworLyogQXQgbW9zdCB3ZSBjYW4gaGF2ZSBvbmUg
Y2dyb3VwIFYxIHRyZWUgZm9yIGVhY2ggY29udHJvbGxlciBhbmQgb25lCisgKiAoZW1wdHkpIHYy
IHRyZWUuCisgKi8KKyNkZWZpbmUgVFNUX0NHUk9VUF9NQVhfVFJFRVMgKFRTVF9DR1JPVVBfTUFY
ICsgMSkKKworCisvKiBVc2VkIHRvIHNwZWNpZnkgQ0dyb3VwIGhpZXJhcmNoeSBjb25maWd1cmF0
aW9uIG9wdGlvbnMsIGFsbG93aW5nIGEKKyAqIHRlc3QgdG8gcmVxdWVzdCBhIHBhcnRpY3VsYXIg
Q0dyb3VwIHN0cnVjdHVyZS4KKyAqLworc3RydWN0IHRzdF9jZ3JvdXBfb3B0cyB7CisJLyogT25s
eSB0cnkgdG8gbW91bnQgVjEgQ0dyb3VwIGNvbnRyb2xsZXJzLiBUaGlzIHdpbGwgbm90CisJICog
cHJldmVudCBWMiBmcm9tIGJlaW5nIHVzZWQgaWYgaXQgaXMgYWxyZWFkeSBtb3VudGVkLCBpdAor
CSAqIG9ubHkgaW5kaWNhdGVzIHRoYXQgd2Ugc2hvdWxkIG1vdW50IFYxIGNvbnRyb2xsZXJzIGlm
CisJICogbm90aGluZyBpcyBwcmVzZW50LiBCeSBkZWZhdWx0IHdlIHRyeSB0byBtb3VudCBWMiBm
aXJzdC4gKi8KKwlpbnQgb25seV9tb3VudF92MToxOworfTsKKworc3RydWN0IHRzdF9jZ3JvdXBf
dHJlZTsKKworc3RydWN0IHRzdF9jZ3JvdXBfbG9jYXRpb24geworCWNvbnN0IGNoYXIgKm5hbWU7
CisJY29uc3Qgc3RydWN0IHRzdF9jZ3JvdXBfdHJlZSAqdHJlZTsKK307CisKKy8qIFNlYXJjaCB0
aGUgc3lzdGVtIGZvciBtb3VudGVkIGNncm91cHMgYW5kIGF2YWlsYWJsZQorICogY29udHJvbGxl
cnMuIENhbGxlZCBhdXRvbWF0aWNhbGx5IGJ5IHRzdF9jZ3JvdXBfcmVxdWlyZS4KKyAqLwordm9p
ZCB0c3RfY2dyb3VwX3NjYW4odm9pZCk7CisvKiBQcmludCB0aGUgY29uZmlnIGRldGVjdGVkIGJ5
IHRzdF9jZ3JvdXBfc2NhbiAqLwordm9pZCB0c3RfY2dyb3VwX3ByaW50X2NvbmZpZyh2b2lkKTsK
KworLyogRW5zdXJlIHRoZSBzcGVjaWZpZWQgY29udHJvbGxlciBpcyBhdmFpbGFibGUgaW4gdGhl
IHRlc3QncyBkZWZhdWx0CisgKiBDR3JvdXAsIG1vdW50aW5nL2VuYWJsaW5nIGl0IGlmIG5lY2Vz
c2FyeSAqLwordm9pZCB0c3RfY2dyb3VwX3JlcXVpcmUoZW51bSB0c3RfY2dyb3VwX2N0cmwgdHlw
ZSwKKwkJCWNvbnN0IHN0cnVjdCB0c3RfY2dyb3VwX29wdHMgKm9wdGlvbnMpOworCisvKiBUZWFy
IGRvd24gYW55IENHcm91cHMgY3JlYXRlZCBieSBjYWxscyB0byB0c3RfY2dyb3VwX3JlcXVpcmUg
Ki8KK3ZvaWQgdHN0X2Nncm91cF9jbGVhbnVwKHZvaWQpOworCisjZW5kaWYgLyogVFNUX0NHUk9V
UF9DT1JFX0ggKi8KZGlmZiAtLWdpdCBhL2luY2x1ZGUvdHN0X2Nncm91cF9pdGVtLmggYi9pbmNs
dWRlL3RzdF9jZ3JvdXBfaXRlbS5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAw
MC4uNDc2YzA2ZDg2Ci0tLSAvZGV2L251bGwKKysrIGIvaW5jbHVkZS90c3RfY2dyb3VwX2l0ZW0u
aApAQCAtMCwwICsxLDEzOSBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEdQTC0yLjAt
b3ItbGF0ZXIKKy8qCisgKiBDb3B5cmlnaHQgKGMpIDIwMjAtMjAyMSBTVVNFIExMQyA8cnBhbGV0
aG9ycGVAc3VzZS5jb20+CisgKi8KKyNpZm5kZWYgVFNUX0NHUk9VUF9JVEVNX0gKKyNkZWZpbmUg
VFNUX0NHUk9VUF9JVEVNX0gKKworLyogQ0dyb3VwIEl0ZW0gRGVjbGFyYXRpb25zICovCisKKwor
dHlwZWRlZiBjb25zdCBzdHJ1Y3QgdHN0X2Nncm91cF9pdGVtICpjb25zdCAqdHN0X2Nncm91cF9p
dGVtX3B0cjsKKy8qIEJhc2UgQ0dyb3VwIEl0ZW0gb3BlcmF0aW9ucworICoKKyAqIE5vdGUsIGZv
ciBhbGwgY2FsbGJhY2tzLCB3ZSBwYXNzIGEgcG9pbnRlciB0byB0aGUgaXRlbSBmaWVsZCB3aXRo
aW4KKyAqIHRoZSBjb250YWluaW5nIG9iamVjdC4gVGhlbiB1c2UgdGhlIGNvbnRhaW5lcl9vZiB0
cmljayB0byBnZXQgdGhlCisgKiBzcGVjaWZpYyB0c3RfY2dyb3VwXyogc3RydWN0LiBUaGlzIGF2
b2lkcyBwYXNzaW5nIGEgdm9pZCBwb2ludGVyCisgKiB3aGljaCBoYXMgbm8gdHlwZSBjaGVja2lu
ZyBhdGFsbC4KKyAqLworc3RydWN0IHRzdF9jZ3JvdXBfaXRlbSB7CisJaW50ICgqZXhpc3RzKShj
b25zdCBjaGFyICosIGNvbnN0IGludCwgdHN0X2Nncm91cF9pdGVtX3B0cik7Cit9OworCitzdHJ1
Y3QgdHN0X2Nncm91cF9maWxlIHsKKwljb25zdCBzdHJ1Y3QgdHN0X2Nncm91cF9pdGVtICppdGVt
OworCisJdW5zaWduZWQgaW50IG47CisJc3RydWN0IHRzdF9jZ3JvdXBfbG9jYXRpb24gbG9jYXRp
b25zW1RTVF9DR1JPVVBfTUFYX1RSRUVTXTsKK307CisKKy8qIEdlbmVyaWMgQ29udHJvbCBHcm91
cCAoY2dyb3VwKSBwYXJhbWV0ZXJzICovCitzdHJ1Y3QgdHN0X2Nncm91cF9jZ3JvdXAgeworCWNv
bnN0IHN0cnVjdCB0c3RfY2dyb3VwX2l0ZW0gKml0ZW07CisKKwkvKiB0YXNrcyBvbiBWMSwgY2dy
b3VwLnByb2NzIG9uIFYyICovCisJc3RydWN0IHRzdF9jZ3JvdXBfZmlsZSBwcm9jczsKKwkvKiBP
bmx5IFYxICovCisJc3RydWN0IHRzdF9jZ3JvdXBfZmlsZSBjbG9uZV9jaGlsZHJlbjsKKwkvKiBP
bmx5IFYyICovCisJc3RydWN0IHRzdF9jZ3JvdXBfZmlsZSBzdWJ0cmVlX2NvbnRyb2w7Cit9Owor
CisvKiBPbiBWMSB0aGlzIGlzIG1lbXN3ICovCitzdHJ1Y3QgdHN0X2Nncm91cF9tZW1vcnlfc3dh
cCB7CisJY29uc3Qgc3RydWN0IHRzdF9jZ3JvdXBfaXRlbSAqaXRlbTsKKworCXN0cnVjdCB0c3Rf
Y2dyb3VwX2ZpbGUgY3VycmVudDsKKwlzdHJ1Y3QgdHN0X2Nncm91cF9maWxlIG1heDsKK307CisK
Ky8qIE9ubHkgb24gVjEgKGJ1dCBzYW1lIGluZm8gbWF5IGJlIGluIG1lbW9yeS5zdGF0IG9uIFYy
KSAqLworc3RydWN0IHRzdF9jZ3JvdXBfbWVtb3J5X2ttZW0geworCWNvbnN0IHN0cnVjdCB0c3Rf
Y2dyb3VwX2l0ZW0gKml0ZW07CisKKwlzdHJ1Y3QgdHN0X2Nncm91cF9maWxlIGN1cnJlbnQ7CisJ
c3RydWN0IHRzdF9jZ3JvdXBfZmlsZSBtYXg7Cit9OworCisvKiBtZW1vcnkgKG1lbWNnKSBjb250
cm9sbGVyICovCitzdHJ1Y3QgdHN0X2Nncm91cF9tZW1vcnkgeworCWNvbnN0IHN0cnVjdCB0c3Rf
Y2dyb3VwX2l0ZW0gKml0ZW07CisJZW51bSB0c3RfY2dyb3VwX3ZlciB2ZXI7CisKKwlzdHJ1Y3Qg
dHN0X2Nncm91cF9tZW1vcnlfa21lbSBrbWVtOworCXN0cnVjdCB0c3RfY2dyb3VwX21lbW9yeV9z
d2FwIHN3YXA7CisKKwkvKiB1c2FnZV9pbl9ieXRlcyBvbiBWMSAqLworCXN0cnVjdCB0c3RfY2dy
b3VwX2ZpbGUgY3VycmVudDsKKwkvKiBsaW1pdF9pbl9ieXRlcyBvbiBWMSAqLworCXN0cnVjdCB0
c3RfY2dyb3VwX2ZpbGUgbWF4OworCS8qIE9ubHkgb24gVjEgYXMgb2YgNS4xMSAqLworCXN0cnVj
dCB0c3RfY2dyb3VwX2ZpbGUgc3dhcHBpbmVzczsKK307CisKKy8qIGNwdXNldCBjb250cm9sbGVy
ICovCitzdHJ1Y3QgdHN0X2Nncm91cF9jcHVzZXQgeworCWNvbnN0IHN0cnVjdCB0c3RfY2dyb3Vw
X2l0ZW0gKml0ZW07CisJZW51bSB0c3RfY2dyb3VwX3ZlciB2ZXI7CisKKwlzdHJ1Y3QgdHN0X2Nn
cm91cF9maWxlIGNwdXM7CisJc3RydWN0IHRzdF9jZ3JvdXBfZmlsZSBtZW1zOworCisJc3RydWN0
IHRzdF9jZ3JvdXBfZmlsZSBtZW1vcnlfbWlncmF0ZTsKK307CisKKy8qIEEgQ29udHJvbCBHcm91
cCBpbiBMVFAncyBhZ2dyZWdhdGVkIGhpZXJhcmNoeSAqLworc3RydWN0IHRzdF9jZ3JvdXAgewor
CWNvbnN0IHN0cnVjdCB0c3RfY2dyb3VwX2l0ZW0gKml0ZW07CisKKwl1bnNpZ25lZCBpbnQgbjsK
KwlzdHJ1Y3QgdHN0X2Nncm91cF90cmVlICp0cmVlc1tUU1RfQ0dST1VQX01BWF9UUkVFU107CisK
KwlzdHJ1Y3QgdHN0X2Nncm91cF9jZ3JvdXAgY2dyb3VwOworCXN0cnVjdCB0c3RfY2dyb3VwX2Nw
dXNldCBjcHVzZXQ7CisJc3RydWN0IHRzdF9jZ3JvdXBfbWVtb3J5IG1lbW9yeTsKK307CisKKy8q
IEdldCB0aGUgZGVmYXVsdCBDR3JvdXAgZm9yIHRoZSB0ZXN0LiBJdCBhbGxvY2F0ZXMgbWVtb3J5
IChpbiBhCisgKiBndWFyZGVkIGJ1ZmZlcikgc28gc2hvdWxkIGFsd2F5cyBiZSBjYWxsZWQgZnJv
bSBzZXR1cAorICovCitjb25zdCBzdHJ1Y3QgdHN0X2Nncm91cCAqdHN0X2Nncm91cF9nZXRfZGVm
YXVsdCh2b2lkKTsKKy8qIEdldCB0aGUgc2hhcmVkIGRyYWluIGdyb3VwLiBBbHNvIHNob3VsZCBi
ZSBjYWxsZWQgZnJvbSBzZXR1cCAqLworY29uc3Qgc3RydWN0IHRzdF9jZ3JvdXAgKnRzdF9jZ3Jv
dXBfZ2V0X2RyYWluKHZvaWQpOworLyogQ3JlYXRlIGEgZGVzY2VuZGFudCBDR3JvdXAgKi8KK3N0
cnVjdCB0c3RfY2dyb3VwICp0c3RfY2dyb3VwX21rKGNvbnN0IHN0cnVjdCB0c3RfY2dyb3VwICpw
YXJlbnQsCisJCQkJIGNvbnN0IGNoYXIgKm5hbWUpOworLyogUmVtb3ZlIGEgZGVzY2VuZGFudCBD
R3JvdXAgKi8KK3N0cnVjdCB0c3RfY2dyb3VwICp0c3RfY2dyb3VwX3JtKHN0cnVjdCB0c3RfY2dy
b3VwICpjZyk7CisKKyNkZWZpbmUgU0FGRV9DR1JPVVBfUkVBRChmaWxlLCBvdXQsIGxlbikgXAor
CXNhZmVfY2dyb3VwX3JlYWQoX19GSUxFX18sIF9fTElORV9fLCAoZmlsZSksIChvdXQpLCAobGVu
KSk7CisKK3NzaXplX3Qgc2FmZV9jZ3JvdXBfcmVhZChjb25zdCBjaGFyICpmaWxlLCBjb25zdCBp
bnQgbGluZW5vLAorCQkJIGNvbnN0IHN0cnVjdCB0c3RfY2dyb3VwX2ZpbGUgKmNnZiwKKwkJCSBj
aGFyICpvdXQsIHNpemVfdCBsZW4pOworCisvKiBQcmludCB0byBhIGNvbnRyb2wgZmlsZSBpbiB0
aGUgdGVzdCdzIGRlZmF1bHQgQ0dyb3VwICovCisjZGVmaW5lIFNBRkVfQ0dST1VQX1BSSU5URihm
aWxlLCBmbXQsIC4uLikgXAorCXNhZmVfY2dyb3VwX3ByaW50ZihfX0ZJTEVfXywgX19MSU5FX18s
IChmaWxlKSwgKGZtdCksIF9fVkFfQVJHU19fKQorCisjZGVmaW5lIFNBRkVfQ0dST1VQX1BSSU5U
KGZpbGUsIHN0cikgXAorCXNhZmVfY2dyb3VwX3ByaW50ZihfX0ZJTEVfXywgX19MSU5FX18sIChm
aWxlKSwgIiVzIiwgKHN0cikpCisKK3ZvaWQgc2FmZV9jZ3JvdXBfcHJpbnRmKGNvbnN0IGNoYXIg
KmZpbGUsIGNvbnN0IGludCBsaW5lbm8sCisJCQljb25zdCBzdHJ1Y3QgdHN0X2Nncm91cF9maWxl
ICpjZ2YsCisJCQljb25zdCBjaGFyICpmbXQsIC4uLikKKwkJCV9fYXR0cmlidXRlX18gKChmb3Jt
YXQgKHByaW50ZiwgNCwgNSkpKTsKKworI2RlZmluZSBTQUZFX0NHUk9VUF9TQ0FORihmaWxlLCBm
bXQsIC4uLikJCQkJXAorCXNhZmVfY2dyb3VwX3NjYW5mKF9fRklMRV9fLCBfX0xJTkVfXywgKGZp
bGUpLCAoZm10KSwgX19WQV9BUkdTX18pCisKK3ZvaWQgc2FmZV9jZ3JvdXBfc2NhbmYoY29uc3Qg
Y2hhciAqZmlsZSwgY29uc3QgaW50IGxpbmVubywKKwkJICAgICAgIGNvbnN0IHN0cnVjdCB0c3Rf
Y2dyb3VwX2ZpbGUgKmNnZiwKKwkJICAgICAgIGNvbnN0IGNoYXIgKmZtdCwgLi4uKQorCQkgICAg
ICAgX19hdHRyaWJ1dGVfXyAoKGZvcm1hdCAoc2NhbmYsIDQsIDUpKSk7CisKKyNkZWZpbmUgVFNU
X0NHUk9VUF9IQVMob2JqKSBcCisJKCgob2JqKS0+aXRlbSktPmV4aXN0cyhfX0ZJTEVfXywgX19M
SU5FX18sICYob2JqKS0+aXRlbSkpCisKKyNlbmRpZiAvKiBUU1RfQ0dST1VQX0lURU1fSCAqLwpk
aWZmIC0tZ2l0IGEvaW5jbHVkZS90c3RfdGVzdC5oIGIvaW5jbHVkZS90c3RfdGVzdC5oCmluZGV4
IDFmYmViZTc1Mi4uNjJhYjI5ODFmIDEwMDY0NAotLS0gYS9pbmNsdWRlL3RzdF90ZXN0LmgKKysr
IGIvaW5jbHVkZS90c3RfdGVzdC5oCkBAIC0zOSw3ICszOSw2IEBACiAjaW5jbHVkZSAidHN0X2Nh
cGFiaWxpdHkuaCIKICNpbmNsdWRlICJ0c3RfaHVnZXBhZ2UuaCIKICNpbmNsdWRlICJ0c3RfYXNz
ZXJ0LmgiCi0jaW5jbHVkZSAidHN0X2Nncm91cC5oIgogI2luY2x1ZGUgInRzdF9sb2NrZG93bi5o
IgogI2luY2x1ZGUgInRzdF9maXBzLmgiCiAjaW5jbHVkZSAidHN0X3RhaW50LmgiCmRpZmYgLS1n
aXQgYS9saWIvdHN0X2Nncm91cC5jIGIvbGliL3RzdF9jZ3JvdXAuYwppbmRleCA5NmM5NTI0ZDIu
LjZmYTcyNWYzNyAxMDA2NDQKLS0tIGEvbGliL3RzdF9jZ3JvdXAuYworKysgYi9saWIvdHN0X2Nn
cm91cC5jCkBAIC0yLDQ1MyArMiwxMDczIEBACiAvKgogICogQ29weXJpZ2h0IChjKSAyMDIwIFJl
ZCBIYXQsIEluYy4KICAqIENvcHlyaWdodCAoYykgMjAyMCBMaSBXYW5nIDxsaXdhbmdAcmVkaGF0
LmNvbT4KKyAqIENvcHlyaWdodCAoYykgMjAyMC0yMDIxIFNVU0UgTExDIDxycGFsZXRob3JwZUBz
dXNlLmNvbT4KICAqLwogCiAjZGVmaW5lIFRTVF9OT19ERUZBVUxUX01BSU4KIAogI2luY2x1ZGUg
PHN0ZGlvLmg+CisjaW5jbHVkZSA8c3RkZGVmLmg+CiAjaW5jbHVkZSA8c3RkbGliLmg+CisjaW5j
bHVkZSA8bW50ZW50Lmg+CiAjaW5jbHVkZSA8c3lzL21vdW50Lmg+Ci0jaW5jbHVkZSA8ZmNudGwu
aD4KLSNpbmNsdWRlIDx1bmlzdGQuaD4KIAogI2luY2x1ZGUgInRzdF90ZXN0LmgiCi0jaW5jbHVk
ZSAidHN0X3NhZmVfbWFjcm9zLmgiCi0jaW5jbHVkZSAidHN0X3NhZmVfc3RkaW8uaCIKKyNpbmNs
dWRlICJsYXBpL2ZjbnRsLmgiCisjaW5jbHVkZSAibGFwaS9tb3VudC5oIgorI2luY2x1ZGUgImxh
cGkvbWtkaXJhdC5oIgogI2luY2x1ZGUgInRzdF9jZ3JvdXAuaCIKLSNpbmNsdWRlICJ0c3RfZGV2
aWNlLmgiCiAKLXN0YXRpYyBlbnVtIHRzdF9jZ3JvdXBfdmVyIHRzdF9jZ192ZXI7Ci1zdGF0aWMg
aW50IGNsb25lX2NoaWxkcmVuOworLyogQ0dyb3VwIENvcmUgSW1wbGVtZW50YXRpb24KKyAqCisg
KiBDR3JvdXAgSXRlbSBJbXBsZW1lbnRhdGlvbiBpcyB0b3dhcmRzIHRoZSBib3R0b20uCisgKi8K
Kworc3RydWN0IGNncm91cF9yb290OworCisvKiBBIG5vZGUgaW4gYSBzaW5nbGUgQ0dyb3VwIGhp
ZXJhcmNoeS4gSXQgZXhpc3RzIG1haW5seSBmb3IKKyAqIGNvbnZlbmllbmNlIHNvIHRoYXQgd2Ug
ZG8gbm90IGhhdmUgdG8gdHJhdmVyc2UgdGhlIENHcm91cCBzdHJ1Y3R1cmUKKyAqIGZvciBmcmVx
dWVudCBvcGVyYXRpb25zLgorICoKKyAqIFRoaXMgaXMgYWN0dWFsbHkgYSBzaW5nbGUtbGlua2Vk
IGxpc3Qgbm90IGEgdHJlZS4gV2Ugb25seSBuZWVkIHRvCisgKiB0cmF2ZXJzZSBmcm9tIGxlYWYg
dG93YXJkcyByb290LgorICovCitzdHJ1Y3QgdHN0X2Nncm91cF90cmVlIHsKKwkvKiBUaGUgdHJl
ZSdzIG5hbWUgYW5kIHBhcmVudCAqLworCXN0cnVjdCB0c3RfY2dyb3VwX2xvY2F0aW9uIGxvYzsK
KwkvKiBTaG9ydGN1dCB0byByb290ICovCisJY29uc3Qgc3RydWN0IGNncm91cF9yb290ICpyb290
OworCisJLyogU3Vic3lzdGVtcyAoY29udHJvbGxlcnMpIGJpdCBmaWVsZC4gT25seSBjb250cm9s
bGVycyB3aGljaAorCSAqIHdlcmUgcmVxdWlyZWQgYW5kIGNvbmZpZ3VyZWQgZm9yIHRoaXMgbm9k
ZSBhcmUgYWRkZWQgdG8KKwkgKiB0aGlzIGZpZWxkLiBTbyBpdCBtYXkgYmUgZGlmZmVyZW50IGZy
b20gcm9vdC0+c3NfZmllbGQuCisJICovCisJdWludDMyX3Qgc3NfZmllbGQ7CisKKwkvKiBJbiBn
ZW5lcmFsIHdlIGF2b2lkIGhhdmluZyBzcHJpbnRmcyBldmVyeXdoZXJlIGFuZCB1c2UKKwkgKiBv
cGVuYXQsIGxpbmthdCwgZXRjLgorCSAqLworCWludCBkaXI7CisKKwlpbnQgd2VfY3JlYXRlZF9p
dDoxOworfTsKKworLyogVGhlIHJvb3Qgb2YgYSBDR3JvdXAgaGllcmFyY2h5L3RyZWUgKi8KK3N0
cnVjdCBjZ3JvdXBfcm9vdCB7CisJZW51bSB0c3RfY2dyb3VwX3ZlciB2ZXI7CisJLyogQSBtb3Vu
dCBwYXRoICovCisJY2hhciBwYXRoW1BBVEhfTUFYLzJdOworCS8qIFN1YnN5c3RlbXMgKGNvbnRy
b2xsZXJzKSBiaXQgZmllbGQuIEluY2x1ZGVzIGFsbAorCSAqIGNvbnRyb2xsZXJzIGZvdW5kIHdo
aWxlIHNjYW5uaW5ndGhpcyByb290LgorCSAqLworCXVpbnQzMl90IHNzX2ZpZWxkOworCisJLyog
Q0dyb3VwIGhpZXJhcmNoeTogbW50IC0+IGx0cCAtPiB7ZHJhaW4sIHRlc3QgLT4gPz8/IH0gV2UK
KwkgKiBrZWVwIGEgZmxhdCByZWZlcmVuY2UgdG8gbHRwLCBkcmFpbiBhbmQgdGVzdCBmb3IKKwkg
KiBjb252ZW5pZW5jZS4KKwkgKi8KKworCS8qIE1vdW50IGRpcmVjdG9yeSAqLworCXN0cnVjdCB0
c3RfY2dyb3VwX3RyZWUgbW50OworCS8qIExUUCBDR3JvdXAgZGlyZWN0b3J5LCBjb250YWlucyBk
cmFpbiBhbmQgdGVzdCBkaXJzICovCisJc3RydWN0IHRzdF9jZ3JvdXBfdHJlZSBsdHA7CisJLyog
RHJhaW4gQ0dyb3VwLCBzZWUgY2dyb3VwX2NsZWFudXAgKi8KKwlzdHJ1Y3QgdHN0X2Nncm91cF90
cmVlIGRyYWluOworCS8qIENHcm91cCBmb3IgY3VycmVudCB0ZXN0LiBXaGljaCBtYXkgaGF2ZSBj
aGlsZHJlbi4gKi8KKwlzdHJ1Y3QgdHN0X2Nncm91cF90cmVlIHRlc3Q7CisKKwlpbnQgd2VfbW91
bnRlZF9pdDoxOworCS8qIGNwdXNldCBpcyBpbiBjb21wYXRhYmlsaXR5IG1vZGUgKi8KKwlpbnQg
bm9fcHJlZml4OjE7Cit9OworCisvKiAnc3MnIHN0YW5kcyBmb3Igc3Vic3lzdGVtIHdoaWNoIGlz
IHRoZSBzYW1lIGFzICdjb250cm9sbGVyJyAqLworc3RydWN0IGNncm91cF9zcyB7CisJZW51bSB0
c3RfY2dyb3VwX2N0cmwgaW5keDsKKwljb25zdCBjaGFyICpuYW1lOworCXN0cnVjdCBjZ3JvdXBf
cm9vdCAqdHJlZTsKKworCWludCB3ZV9yZXF1aXJlX2l0OjE7Cit9OworCisvKiBBbHdheXMgdXNl
IGZpcnN0IGl0ZW0gZm9yIHVuaWZpZWQgaGllcmFyY2h5ICovCitzdHJ1Y3QgY2dyb3VwX3Jvb3Qg
cm9vdHNbVFNUX0NHUk9VUF9NQVhfVFJFRVMgKyAxXTsKIAotc3RhdGljIGludCB0c3RfY2dyb3Vw
X2NoZWNrKGNvbnN0IGNoYXIgKmNncm91cCkKK3N0YXRpYyBzdHJ1Y3QgY2dyb3VwX3NzIGNzc1tU
U1RfQ0dST1VQX01BWCArIDFdID0geworCXsgVFNUX0NHUk9VUF9NRU1PUlksICJtZW1vcnkiLCBO
VUxMLCAwIH0sCisJeyBUU1RfQ0dST1VQX0NQVVNFVCwgImNwdXNldCIsIE5VTEwsIDAgfSwKK307
CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgdHN0X2Nncm91cF9vcHRzIGRlZmF1bHRfb3B0cyA9IHsg
MCB9OworCisvKiBXZSBzaG91bGQgcHJvYmFibHkgYWxsb3cgdGhlc2UgdG8gYmUgc2V0IGluIGVu
dmlyb25tZW50CisgKiB2YXJpYWJsZXMgKi8KK3N0YXRpYyBjb25zdCBjaGFyICpsdHBfY2dyb3Vw
X2RpciA9ICJsdHAiOworc3RhdGljIGNvbnN0IGNoYXIgKmx0cF9jZ3JvdXBfZHJhaW5fZGlyID0g
ImRyYWluIjsKK3N0YXRpYyBjaGFyIHRlc3RfY2dyb3VwX2RpcltQQVRIX01BWC80XTsKK3N0YXRp
YyBjb25zdCBjaGFyICpsdHBfbW91bnRfcHJlZml4ID0gIi90bXAvY2dyb3VwXyI7CitzdGF0aWMg
Y29uc3QgY2hhciAqbHRwX3YyX21vdW50ID0gInVuaWZpZWQiOworCisjZGVmaW5lIGZpcnN0X3Jv
b3QJCQkJXAorCShyb290c1swXS52ZXIgPyByb290cyA6IHJvb3RzICsgMSkKKyNkZWZpbmUgZm9y
X2VhY2hfcm9vdChyKQkJCVwKKwlmb3IgKChyKSA9IGZpcnN0X3Jvb3Q7IChyKS0+dmVyOyAocikr
KykKKyNkZWZpbmUgZm9yX2VhY2hfdjFfcm9vdChyKQkJCVwKKwlmb3IgKChyKSA9IHJvb3RzICsg
MTsgKHIpLT52ZXI7IChyKSsrKQorI2RlZmluZSBmb3JfZWFjaF9jc3Moc3MpCQkJXAorCWZvciAo
KHNzKSA9IGNzczsgKHNzKS0+aW5keDsgKHNzKSsrKQorCitzdGF0aWMgaW50IGhhc19jc3ModWlu
dDMyX3Qgc3NfZmllbGQsIGVudW0gdHN0X2Nncm91cF9jdHJsIHR5cGUpCiB7Ci0JY2hhciBsaW5l
W1BBVEhfTUFYXTsKLQlGSUxFICpmaWxlOwotCWludCBjZ19jaGVjayA9IDA7CisJcmV0dXJuICEh
KHNzX2ZpZWxkICYgKDEgPDwgdHlwZSkpOworfQogCi0JZmlsZSA9IFNBRkVfRk9QRU4oIi9wcm9j
L2ZpbGVzeXN0ZW1zIiwgInIiKTsKLQl3aGlsZSAoZmdldHMobGluZSwgc2l6ZW9mKGxpbmUpLCBm
aWxlKSkgewotCQlpZiAoc3Ryc3RyKGxpbmUsIGNncm91cCkgIT0gTlVMTCkgewotCQkJY2dfY2hl
Y2sgPSAxOwotCQkJYnJlYWs7Ci0JCX0KK3N0YXRpYyB2b2lkIGFkZF9jc3ModWludDMyX3QgKnNz
X2ZpZWxkLCBpbnQgY29uZCwgZW51bSB0c3RfY2dyb3VwX2N0cmwgdHlwZSkKK3sKKwkqc3NfZmll
bGQgfD0gKCEhY29uZCkgPDwgdHlwZTsKK30KKworc3RydWN0IGNncm91cF9yb290ICp0c3RfY2dy
b3VwX3Jvb3RfZ2V0KHZvaWQpCit7CisJcmV0dXJuIHJvb3RzWzBdLnZlciA/IHJvb3RzIDogcm9v
dHMgKyAxOworfQorCitzdGF0aWMgaW50IGNncm91cF92Ml9tb3VudGVkKHZvaWQpCit7CisJcmV0
dXJuICEhcm9vdHNbMF0udmVyOworfQorCitzdGF0aWMgaW50IGNncm91cF92MV9tb3VudGVkKHZv
aWQpCit7CisJcmV0dXJuICEhcm9vdHNbMV0udmVyOworfQorCitzdGF0aWMgaW50IGNncm91cF9t
b3VudGVkKHZvaWQpCit7CisJcmV0dXJuIGNncm91cF92Ml9tb3VudGVkKCkgfHwgY2dyb3VwX3Yx
X21vdW50ZWQoKTsKK30KKworc3RhdGljIHN0cnVjdCBjZ3JvdXBfc3MgKmNncm91cF9nZXRfc3Mo
ZW51bSB0c3RfY2dyb3VwX2N0cmwgdHlwZSkKK3sKKwlyZXR1cm4gJmNzc1t0eXBlIC0gMV07Cit9
CisKK3N0YXRpYyBpbnQgY2dyb3VwX3NzX29uX3YyKGNvbnN0IHN0cnVjdCBjZ3JvdXBfc3MgKnNz
KQoreworCXJldHVybiBzcy0+dHJlZS0+dmVyID09IFRTVF9DR1JPVVBfVjI7Cit9CisKK2ludCB0
c3RfY2dyb3VwX3RyZWVfbWsoY29uc3Qgc3RydWN0IHRzdF9jZ3JvdXBfdHJlZSAqcGFyZW50LAor
CQkgICAgICAgY29uc3QgY2hhciAqbmFtZSwKKwkJICAgICAgIHN0cnVjdCB0c3RfY2dyb3VwX3Ry
ZWUgKm5ldykKK3sKKwljaGFyICpkcGF0aDsKKworCW5ldy0+cm9vdCA9IHBhcmVudC0+cm9vdDsK
KwluZXctPmxvYy5uYW1lID0gbmFtZTsKKwluZXctPmxvYy50cmVlID0gcGFyZW50OworCW5ldy0+
c3NfZmllbGQgPSBwYXJlbnQtPnNzX2ZpZWxkOworCW5ldy0+d2VfY3JlYXRlZF9pdCA9IDA7CisK
KwlpZiAoIW1rZGlyYXQocGFyZW50LT5kaXIsIG5hbWUsIDA3NzcpKSB7CisJCW5ldy0+d2VfY3Jl
YXRlZF9pdCA9IDE7CisJCWdvdG8gb3BlbmRpcjsKKwl9CisKKwlpZiAoZXJybm8gPT0gRUVYSVNU
KQorCQlnb3RvIG9wZW5kaXI7CisKKwlkcGF0aCA9IHRzdF9kZWNvZGVfZmQocGFyZW50LT5kaXIp
OworCisJaWYgKGVycm5vID09IEVBQ0NFUykgeworCQl0c3RfYnJrKFRDT05GIHwgVEVSUk5PLAor
CQkJIkxhY2sgcGVybWlzc2lvbiB0byBtYWtlICclcy8lcyc7IHByZW1ha2UgaXQgb3IgcnVuIGFz
IHJvb3QiLAorCQkJZHBhdGgsIG5hbWUpOworCX0gZWxzZSB7CisJCXRzdF9icmsoVEJST0sgfCBU
RVJSTk8sCisJCQkibWtkaXJhdCglZDwlcz4sICclcycsIDA3NzcpIiwgcGFyZW50LT5kaXIsIGRw
YXRoLCBuYW1lKTsKKwl9CisKKwlyZXR1cm4gLTE7CitvcGVuZGlyOgorCW5ldy0+ZGlyID0gU0FG
RV9PUEVOQVQocGFyZW50LT5kaXIsIG5hbWUsIE9fUEFUSCB8IE9fRElSRUNUT1JZKTsKKworCXJl
dHVybiAwOworfQorCit2b2lkIHRzdF9jZ3JvdXBfcHJpbnRfY29uZmlnKHZvaWQpCit7CisJc3Ry
dWN0IGNncm91cF9yb290ICp0OworCXN0cnVjdCBjZ3JvdXBfc3MgKnNzOworCisJdHN0X3JlcyhU
SU5GTywgIkRldGVjdGVkIENvbnRyb2xsZXJzOiIpOworCisJZm9yX2VhY2hfY3NzKHNzKSB7CisJ
CXQgPSBzcy0+dHJlZTsKKworCQlpZiAoIXQpCisJCQljb250aW51ZTsKKworCQl0c3RfcmVzKFRJ
TkZPLCAiXHQlLjEwcyAlcyBAICVzOiVzIiwKKwkJCXNzLT5uYW1lLAorCQkJdC0+bm9fcHJlZml4
ID8gIltub3ByZWZpeF0iIDogIiIsCisJCQl0LT52ZXIgPT0gVFNUX0NHUk9VUF9WMSA/ICJWMSIg
OiAiVjIiLAorCQkJdC0+cGF0aCk7CisJfQorfQorCisvKiBEZXRlcm1pbmUgaWYgYSBtb3VudGVk
IGNncm91cCBoaWVyYXJjaHkgKHRyZWUpIGlzIHVuaXF1ZSBhbmQgcmVjb3JkIGl0IGlmIHNvLgor
ICoKKyAqIEZvciBDR3JvdXBzIFYyIHRoaXMgaXMgdmVyeSBzaW1wbGUgYXMgdGhlcmUgaXMgb25s
eSBvbmUKKyAqIGhpZXJhcmNoeS4gV2UganVzdCByZWNvcmQgd2hpY2ggY29udHJvbGxlcnMgYXJl
IGF2YWlsYWJsZSBhbmQgY2hlY2sKKyAqIGlmIHRoaXMgbWF0Y2hlcyB3aGF0IHdlIHJlYWQgZnJv
bSBhbnkgcHJldmlvdXMgbW91bnQgcG9pbnRzLgorICoKKyAqIEZvciBWMSB0aGUgc2V0IG9mIGNv
bnRyb2xsZXJzIFMgaXMgcGFydGl0aW9uZWQgaW50byBzZXRzIHtQXzEsIFBfMiwKKyAqIC4uLiwg
UF9ufSB3aXRoIG9uZSBvciBtb3JlIGNvbnRyb2xsZXJzIGluIGVhY2ggcGFydGlvbi4gRWFjaAor
ICogcGFydGl0aW9uIFBfbiBjYW4gYmUgbW91bnRlZCBtdWx0aXBsZSB0aW1lcywgYnV0IHRoZSBz
YW1lCisgKiBjb250cm9sbGVyIGNhbiBub3QgYXBwZWFyIGluIG1vcmUgdGhhbiBvbmUgcGFydGl0
aW9uLiBVc3VhbGx5IGVhY2gKKyAqIHBhcnRpdGlvbiBjb250YWlucyBhIHNpbmdsZSBjb250cm9s
bGVyLCBidXQsIGZvciBleGFtcGxlLCBjcHUgYW5kCisgKiBjcHVhY2N0IGFyZSBvZnRlbiBtb3Vu
dGVkIHRvZ2V0aGVyIGluIHRoZSBzYW1lIHBhcnRpaW9uLgorICoKKyAqIEVhY2ggY29udHJvbGxl
ciBwYXJ0aXRpb24gaGFzIGl0cyBvd24gaGllcmFyY2h5IHdoaWNoIHdlIG11c3QgdHJhY2sKKyAq
IGFuZCB1cGRhdGUgaW5kZXBlbmRlbnRseS4KKyAqLworc3RhdGljIHZvaWQgY2dyb3VwX3Jvb3Rf
c2Nhbihjb25zdCBjaGFyICp0eXBlLCBjb25zdCBjaGFyICpwYXRoLCBjaGFyICpvcHRzKQorewor
CXN0cnVjdCBjZ3JvdXBfcm9vdCAqdCA9IHJvb3RzOworCXN0cnVjdCBjZ3JvdXBfc3MgKmM7CisJ
dWludDMyX3Qgc3NfZmllbGQgPSAwOworCWludCBub19wcmVmaXggPSAwOworCWNoYXIgYnVmW0JV
RlNJWl07CisJY2hhciAqdG9rOworCWludCBkZmQgPSBTQUZFX09QRU4ocGF0aCwgT19QQVRIIHwg
T19ESVJFQ1RPUlkpOworCisJaWYgKCFzdHJjbXAodHlwZSwgImNncm91cCIpKQorCQlnb3RvIHYx
OworCisJU0FGRV9GSUxFX1JFQURBVChkZmQsICJjZ3JvdXAuY29udHJvbGxlcnMiLCBidWYsIHNp
emVvZihidWYpKTsKKworCWZvciAodG9rID0gc3RydG9rKGJ1ZiwgIiAiKTsgdG9rOyB0b2sgPSBz
dHJ0b2soTlVMTCwgIiAiKSkgeworCQlmb3JfZWFjaF9jc3MoYykKKwkJCWFkZF9jc3MoJnNzX2Zp
ZWxkLCAhc3RyY21wKGMtPm5hbWUsIHRvayksIGMtPmluZHgpOworCX0KKworCWlmICh0LT52ZXIg
JiYgc3NfZmllbGQgPT0gdC0+c3NfZmllbGQpCisJCWdvdG8gZGlzY2FyZDsKKworCWlmICh0LT5z
c19maWVsZCkKKwkJdHN0X2JyayhUQlJPSywgIkF2YWlsYWJsZSBWMiBjb250cm9sbGVycyBhcmUg
Y2hhbmdpbmcgYmV0d2VlbiBzY2Fucz8iKTsKKworCXQtPnZlciA9IFRTVF9DR1JPVVBfVjI7CisK
Kwlnb3RvIGJhY2tyZWY7CisKK3YxOgorCWZvciAodG9rID0gc3RydG9rKG9wdHMsICIsIik7IHRv
azsgdG9rID0gc3RydG9rKE5VTEwsICIsIikpIHsKKwkJZm9yX2VhY2hfY3NzKGMpCisJCQlhZGRf
Y3NzKCZzc19maWVsZCwgIXN0cmNtcChjLT5uYW1lLCB0b2spLCBjLT5pbmR4KTsKKworCQlub19w
cmVmaXggfD0gIXN0cmNtcCgibm9wcmVmaXgiLCB0b2spOworCX0KKworCWlmICghc3NfZmllbGQp
CisJCWdvdG8gZGlzY2FyZDsKKworCWZvcl9lYWNoX3YxX3Jvb3QodCkgeworCQlpZiAoIShzc19m
aWVsZCAmIHQtPnNzX2ZpZWxkKSkKKwkJCWNvbnRpbnVlOworCisJCWlmIChzc19maWVsZCA9PSB0
LT5zc19maWVsZCkKKwkJCWdvdG8gZGlzY2FyZDsKKworCQl0c3RfYnJrKFRCUk9LLAorCQkJIlRo
ZSBpbnRlcnNlY3Rpb24gb2YgdHdvIGRpc3RpbmN0IHNldHMgb2YgbW91bnRlZCBjb250cm9sbGVy
cyBzaG91bGQgYmUgbnVsbD8iCisJCQkiQ2hlY2sgJyVzJyBhbmQgJyVzJyIsIHQtPnBhdGgsIHBh
dGgpOworCX0KKworCWlmICh0ID49IHJvb3RzICsgVFNUX0NHUk9VUF9NQVhfVFJFRVMpIHsKKwkJ
dHN0X2JyayhUQlJPSywgIlVuaXF1ZSBjb250cm9sbGVyIG1vdW50cyBoYXZlIGV4Y2VlZGVkIG91
ciBsaW1pdCAlZD8iLAorCQkJVFNUX0NHUk9VUF9NQVhfVFJFRVMpOworCX0KKworCXQtPnZlciA9
IFRTVF9DR1JPVVBfVjE7CisKK2JhY2tyZWY6CisJc3RyY3B5KHQtPnBhdGgsIHBhdGgpOworCXQt
Pm1udC5yb290ID0gdDsKKwl0LT5tbnQubG9jLm5hbWUgPSB0LT5wYXRoOworCXQtPm1udC5kaXIg
PSBkZmQ7CisJdC0+c3NfZmllbGQgPSBzc19maWVsZDsKKwl0LT5ub19wcmVmaXggPSBub19wcmVm
aXg7CisKKwlmb3JfZWFjaF9jc3MoYykgeworCQlpZiAoaGFzX2Nzcyh0LT5zc19maWVsZCwgYy0+
aW5keCkpCisJCQljLT50cmVlID0gdDsKIAl9Ci0JU0FGRV9GQ0xPU0UoZmlsZSk7CiAKLQlyZXR1
cm4gY2dfY2hlY2s7CisJcmV0dXJuOworCitkaXNjYXJkOgorCWNsb3NlKGRmZCk7CiB9CiAKLWVu
dW0gdHN0X2Nncm91cF92ZXIgdHN0X2Nncm91cF92ZXJzaW9uKHZvaWQpCit2b2lkIHRzdF9jZ3Jv
dXBfc2Nhbih2b2lkKQogewotICAgICAgICBlbnVtIHRzdF9jZ3JvdXBfdmVyIGNnX3ZlcjsKKwlz
dHJ1Y3QgbW50ZW50ICptbnQ7CisJRklMRSAqZiA9IHNldG1udGVudCgiL3Byb2Mvc2VsZi9tb3Vu
dHMiLCAiciIpOworCisJaWYgKCFmKQorCQl0c3RfYnJrKFRCUk9LIHwgVEVSUk5PLCAiQ2FuJ3Qg
b3BlbiAvcHJvYy9zZWxmL21vdW50cyIpOworCisJbW50ID0gZ2V0bW50ZW50KGYpOworCWlmICgh
bW50KQorCQl0c3RfYnJrKFRCUk9LIHwgVEVSUk5PLCAiQ2FuJ3QgcmVhZCBtb3VudHMgb3Igbm8g
bW91bnRzPyIpOwogCi0gICAgICAgIGlmICh0c3RfY2dyb3VwX2NoZWNrKCJjZ3JvdXAyIikpIHsK
LSAgICAgICAgICAgICAgICBpZiAoIXRzdF9pc19tb3VudGVkKCJjZ3JvdXAyIikgJiYgdHN0X2lz
X21vdW50ZWQoImNncm91cCIpKQotICAgICAgICAgICAgICAgICAgICAgICAgY2dfdmVyID0gVFNU
X0NHUk9VUF9WMTsKLSAgICAgICAgICAgICAgICBlbHNlCi0gICAgICAgICAgICAgICAgICAgICAg
ICBjZ192ZXIgPSBUU1RfQ0dST1VQX1YyOworCWRvIHsKKwkJaWYgKHN0cm5jbXAobW50LT5tbnRf
dHlwZSwgImNncm91cCIsIDYpKQorCQkJY29udGludWU7CisKKwkJY2dyb3VwX3Jvb3Rfc2Nhbiht
bnQtPm1udF90eXBlLCBtbnQtPm1udF9kaXIsIG1udC0+bW50X29wdHMpOworCX0gd2hpbGUgKCht
bnQgPSBnZXRtbnRlbnQoZikpKTsKK30KKworc3RhdGljIHZvaWQgY2dyb3VwX21vdW50X3YyKHZv
aWQpCit7CisJY2hhciBwYXRoW1BBVEhfTUFYXTsKIAotICAgICAgICAgICAgICAgIGdvdG8gb3V0
OwotICAgICAgICB9CisJc3ByaW50ZihwYXRoLCAiJXMlcyIsIGx0cF9tb3VudF9wcmVmaXgsIGx0
cF92Ml9tb3VudCk7CiAKLSAgICAgICAgaWYgKHRzdF9jZ3JvdXBfY2hlY2soImNncm91cCIpKQot
ICAgICAgICAgICAgICAgIGNnX3ZlciA9IFRTVF9DR1JPVVBfVjE7CisJaWYgKCFta2RpcihwYXRo
LCAwNzc3KSkgeworCQlyb290c1swXS5tbnQud2VfY3JlYXRlZF9pdCA9IDE7CisJCWdvdG8gbW91
bnQ7CisJfQorCisJaWYgKGVycm5vID09IEVFWElTVCkKKwkJZ290byBtb3VudDsKKworCWlmIChl
cnJubyA9PSBFQUNDRVMpIHsKKwkJdHN0X3JlcyhUSU5GTyB8IFRFUlJOTywKKwkJCSJMYWNrIHBl
cm1pc3Npb24gdG8gbWFrZSAlcywgcHJlbWFrZSBpdCBvciBydW4gYXMgcm9vdCIsCisJCQlwYXRo
KTsKKwkJcmV0dXJuOworCX0KKworCXRzdF9icmsoVEJST0sgfCBURVJSTk8sICJta2Rpciglcywg
MDc3NykiLCBwYXRoKTsKKworbW91bnQ6CisJaWYgKCFtb3VudCgiY2dyb3VwMiIsIHBhdGgsICJj
Z3JvdXAyIiwgMCwgTlVMTCkpIHsKKwkJdHN0X3JlcyhUSU5GTywgIk1vdW50ZWQgVjIgQ0dyb3Vw
cyBvbiAlcyIsIHBhdGgpOworCQl0c3RfY2dyb3VwX3NjYW4oKTsKKwkJcm9vdHNbMF0ud2VfbW91
bnRlZF9pdCA9IDE7CisJCXJldHVybjsKKwl9CiAKLSAgICAgICAgaWYgKCFjZ192ZXIpCi0gICAg
ICAgICAgICAgICAgdHN0X2JyayhUQ09ORiwgIkNncm91cCBpcyBub3QgY29uZmlndXJlZCIpOwor
CXRzdF9yZXMoVElORk8gfCBURVJSTk8sICJDb3VsZCBub3QgbW91bnQgVjIgQ0dyb3VwcyBvbiAl
cyIsIHBhdGgpOwogCi1vdXQ6Ci0gICAgICAgIHJldHVybiBjZ192ZXI7CisJaWYgKHJvb3RzWzBd
Lm1udC53ZV9jcmVhdGVkX2l0KSB7CisJCXJvb3RzWzBdLm1udC53ZV9jcmVhdGVkX2l0ID0gMDsK
KwkJU0FGRV9STURJUihwYXRoKTsKKwl9CiB9CiAKLXN0YXRpYyB2b2lkIHRzdF9jZ3JvdXAxX21v
dW50KGNvbnN0IGNoYXIgKm5hbWUsIGNvbnN0IGNoYXIgKm9wdGlvbiwKLQkJCWNvbnN0IGNoYXIg
Km1udF9wYXRoLCBjb25zdCBjaGFyICpuZXdfcGF0aCkKK3N0YXRpYyB2b2lkIGNncm91cF9tb3Vu
dF92MShlbnVtIHRzdF9jZ3JvdXBfY3RybCB0eXBlKQogewotCWNoYXIga25vYl9wYXRoW1BBVEhf
TUFYXTsKLQlpZiAodHN0X2lzX21vdW50ZWQobW50X3BhdGgpKQotCQlnb3RvIG91dDsKKwlzdHJ1
Y3QgY2dyb3VwX3NzICpzcyA9IGNncm91cF9nZXRfc3ModHlwZSk7CisJY2hhciBwYXRoW1BBVEhf
TUFYXTsKKwlpbnQgbWFkZV9kaXIgPSAwOwogCi0JU0FGRV9NS0RJUihtbnRfcGF0aCwgMDc3Nyk7
Ci0JaWYgKG1vdW50KG5hbWUsIG1udF9wYXRoLCAiY2dyb3VwIiwgMCwgb3B0aW9uKSA9PSAtMSkg
ewotCQlpZiAoZXJybm8gPT0gRU5PREVWKSB7Ci0JCQlpZiAocm1kaXIobW50X3BhdGgpID09IC0x
KQotCQkJCXRzdF9yZXMoVFdBUk4gfCBURVJSTk8sICJybWRpciAlcyBmYWlsZWQiLCBtbnRfcGF0
aCk7Ci0JCQl0c3RfYnJrKFRDT05GLAotCQkJCSAiQ2dyb3VwIHYxIGlzIG5vdCBjb25maWd1cmVk
IGluIGtlcm5lbCIpOwotCQl9Ci0JCXRzdF9icmsoVEJST0sgfCBURVJSTk8sICJtb3VudCAlcyIs
IG1udF9wYXRoKTsKKwlzcHJpbnRmKHBhdGgsICIlcyVzIiwgbHRwX21vdW50X3ByZWZpeCwgc3Mt
Pm5hbWUpOworCisJaWYgKCFta2RpcihwYXRoLCAwNzc3KSkgeworCQltYWRlX2RpciA9IDE7CisJ
CWdvdG8gbW91bnQ7CiAJfQogCi0JLyoKLQkgKiBXZSBzaG91bGQgYXNzaWduIG9uZSBvciBtb3Jl
IG1lbW9yeSBub2RlcyB0byBjcHVzZXQubWVtcyBhbmQKLQkgKiBjcHVzZXQuY3B1cywgb3RoZXJ3
aXNlLCBlY2hvICQkID4gdGFza3MgZ2l2ZXMg4oCcRU5PU1BDOiBubyBzcGFjZQotCSAqIGxlZnQg
b24gZGV2aWNl4oCdIHdoZW4gdHJ5aW5nIHRvIHVzZSBjcHVzZXQuCi0JICoKLQkgKiBPciwgc2V0
dGluZyBjZ3JvdXAuY2xvbmVfY2hpbGRyZW4gdG8gMSBjYW4gaGVscCBpbiBhdXRvbWF0aWNhbGx5
Ci0JICogaW5oZXJpdGluZyBtZW1vcnkgYW5kIG5vZGUgc2V0dGluZyBmcm9tIHBhcmVudCBjZ3Jv
dXAgd2hlbiBhCi0JICogY2hpbGQgY2dyb3VwIGlzIGNyZWF0ZWQuCi0JICovCi0JaWYgKHN0cmNt
cChvcHRpb24sICJjcHVzZXQiKSA9PSAwKSB7Ci0JCXNwcmludGYoa25vYl9wYXRoLCAiJXMvY2dy
b3VwLmNsb25lX2NoaWxkcmVuIiwgbW50X3BhdGgpOwotCQlTQUZFX0ZJTEVfU0NBTkYoa25vYl9w
YXRoLCAiJWQiLCAmY2xvbmVfY2hpbGRyZW4pOwotCQlTQUZFX0ZJTEVfUFJJTlRGKGtub2JfcGF0
aCwgIiVkIiwgMSk7CisJaWYgKGVycm5vID09IEVFWElTVCkKKwkJZ290byBtb3VudDsKKworCWlm
IChlcnJubyA9PSBFQUNDRVMpIHsKKwkJdHN0X3JlcyhUSU5GTyB8IFRFUlJOTywKKwkJCSJMYWNr
IHBlcm1pc3Npb24gdG8gbWFrZSAlcywgcHJlbWFrZSBpdCBvciBydW4gYXMgcm9vdCIsCisJCQlw
YXRoKTsKKwkJcmV0dXJuOwogCX0KLW91dDoKLQlTQUZFX01LRElSKG5ld19wYXRoLCAwNzc3KTsK
IAotCXRzdF9yZXMoVElORk8sICJDZ3JvdXAoJXMpIHYxIG1vdW50IGF0ICVzIHN1Y2Nlc3MiLCBv
cHRpb24sIG1udF9wYXRoKTsKKwl0c3RfYnJrKFRCUk9LIHwgVEVSUk5PLCAibWtkaXIoJXMsIDA3
NzcpIiwgcGF0aCk7CisKK21vdW50OgorCWlmIChtb3VudChzcy0+bmFtZSwgcGF0aCwgImNncm91
cCIsIDAsIHNzLT5uYW1lKSkgeworCQl0c3RfcmVzKFRJTkZPIHwgVEVSUk5PLAorCQkJIkNvdWxk
IG5vdCBtb3VudCBWMSBDR3JvdXAgb24gJXMiLCBwYXRoKTsKKworCQlpZiAobWFkZV9kaXIpCisJ
CQlTQUZFX1JNRElSKHBhdGgpOworCQlyZXR1cm47CisJfQorCisJdHN0X3JlcyhUSU5GTywgIk1v
dW50ZWQgVjEgJXMgQ0dyb3VwIG9uICVzIiwgc3MtPm5hbWUsIHBhdGgpOworCXRzdF9jZ3JvdXBf
c2NhbigpOworCXNzLT50cmVlLT53ZV9tb3VudGVkX2l0ID0gMTsKKwlzcy0+dHJlZS0+bW50Lndl
X2NyZWF0ZWRfaXQgPSBtYWRlX2RpcjsKKworCWlmICh0eXBlID09IFRTVF9DR1JPVVBfTUVNT1JZ
KSB7CisJCVNBRkVfRklMRV9QUklOVEZBVChzcy0+dHJlZS0+bW50LmRpciwKKwkJCQkgICAibWVt
b3J5LnVzZV9oaWVyYXJjaHkiLCAiJWQiLCAxKTsKKwl9Cit9CisKK3N0YXRpYyB2b2lkIGNncm91
cF9jb3B5X2NwdXNldChjb25zdCBzdHJ1Y3QgY2dyb3VwX3Jvb3QgKnQpCit7CisJY2hhciBidWZb
QlVGU0laXTsKKwlpbnQgaTsKKwljb25zdCBjaGFyICpuMFtdID0geyJtZW1zIiwgImNwdXMifTsK
Kwljb25zdCBjaGFyICpuMVtdID0geyJjcHVzZXQubWVtcyIsICJjcHVzZXQuY3B1cyJ9OworCWNv
bnN0IGNoYXIgKipmbmFtZSA9IHQtPm5vX3ByZWZpeCA/IG4wIDogbjE7CisKKwlmb3IgKGkgPSAw
OyBpIDwgMjsgaSsrKSB7CisJCVNBRkVfRklMRV9SRUFEQVQodC0+bW50LmRpciwgZm5hbWVbaV0s
IGJ1Ziwgc2l6ZW9mKGJ1ZikpOworCQlTQUZFX0ZJTEVfUFJJTlRGQVQodC0+bHRwLmRpciwgZm5h
bWVbaV0sICIlcyIsIGJ1Zik7CisJfQogfQogCi1zdGF0aWMgdm9pZCB0c3RfY2dyb3VwMl9tb3Vu
dChjb25zdCBjaGFyICptbnRfcGF0aCwgY29uc3QgY2hhciAqbmV3X3BhdGgpCisvKiBFbnN1cmUg
dGhlIHNwZWNpZmllZCBjb250cm9sbGVyIGlzIGF2YWlsYWJsZS4KKyAqCisgKiBGaXJzdCB3ZSBj
aGVjayBpZiB0aGUgc3BlY2lmaWVkIGNvbnRyb2xsZXIgaGFzIGEga25vd24gbW91bnQgcG9pbnQs
CisgKiBpZiBub3QgdGhlbiB3ZSBzY2FuIHRoZSBzeXN0ZW0uIElmIHdlIGZpbmQgaXQgdGhlbiB3
ZSBnb3RvIGVuc3VyaW5nCisgKiB0aGUgTFRQIGdyb3VwIGV4aXN0cyBpbiB0aGUgaGllcmFyY2h5
IHRoZSBjb250cm9sbGVyIGlzIHVzaW5nLgorICoKKyAqIElmIHdlIGNhbid0IGZpbmQgdGhlIGNv
bnRyb2xsZXIsIHRoZW4gd2UgdHJ5IHRvIGNyZWF0ZSBpdC4gRmlyc3Qgd2UKKyAqIGNoZWNrIGlm
IHRoZSBWMiBoaWVyYXJjaHkvdHJlZSBpcyBtb3VudGVkLiBJZiBpdCBpc24ndCB0aGVuIHdlIHRy
eQorICogbW91bnRpbmcgaXQgYW5kIGxvb2sgZm9yIHRoZSBjb250cm9sbGVyLiBJZiBpdCBpcyBh
bHJlYWR5IG1vdW50ZWQKKyAqIHRoZW4gd2Uga25vdyB0aGUgY29udHJvbGxlciBpcyBub3QgYXZh
aWxhYmxlIG9uIFYyIG9uIHRoaXMgc3lzdGVtLgorICoKKyAqIElmIHdlIGNhbid0IG1vdW50IFYy
IG9yIHRoZSBjb250cm9sbGVyIGlzIG5vdCBvbiBWMiwgdGhlbiB3ZSB0cnkKKyAqIG1vdW50aW5n
IGl0IG9uIGl0cyBvd24gVjEgdHJlZS4KKyAqCisgKiBPbmNlIHdlIGhhdmUgbW91bnRlZCB0aGUg
Y29udHJvbGxlciBzb21laG93LCB3ZSBjcmVhdGUgYSBoaWVyYXJjaHkKKyAqIG9mIGNncm91cHMu
IElmIHdlIGFyZSBvbiBWMiB3ZSBmaXJzdCBuZWVkIHRvIGVuYWJsZSB0aGUgY29udHJvbGxlcgor
ICogZm9yIGFsbCBjaGlsZHJlbiBvZiByb290LiBUaGVuIHdlIGNyZWF0ZSBoaWVyYXJjaHkgZGVz
Y3JpYmVkIGluCisgKiB0c3RfY2dyb3VwLmguCisgKgorICogSWYgd2UgYXJlIHVzaW5nIFYxIGNw
dXNldCB0aGVuIHdlIGNvcHkgdGhlIGF2YWlsYWJsZSBtZW1zIGFuZCBjcHVzCisgKiBmcm9tIHJv
b3QgdG8gdGhlIGx0cCBncm91cCBhbmQgc2V0IGNsb25lX2NoaWxkcmVuIG9uIHRoZSBsdHAgZ3Jv
dXAKKyAqIHRvIGRpc3RyaWJ1dGUgdGhlc2Ugc2V0dGluZ3MgdG8gdGhlIHRlc3QgY2dyb3Vwcy4g
VGhpcyBtZWFucyB0aGUKKyAqIHRlc3QgYXV0aG9yIGRvZXMgbm90IGhhdmUgdG8gY29weSB0aGVz
ZSBzZXR0aW5ncyBiZWZvcmUgdXNpbmcgdGhlCisgKiBjcHVzZXQuCisgKgorICovCit2b2lkIHRz
dF9jZ3JvdXBfcmVxdWlyZShlbnVtIHRzdF9jZ3JvdXBfY3RybCB0eXBlLAorCQkJY29uc3Qgc3Ry
dWN0IHRzdF9jZ3JvdXBfb3B0cyAqb3B0aW9ucykKIHsKLQlpZiAodHN0X2lzX21vdW50ZWQobW50
X3BhdGgpKQotCQlnb3RvIG91dDsKKwljb25zdCBjaGFyICpjb25zdCBjZ3NjID0gImNncm91cC5z
dWJ0cmVlX2NvbnRyb2wiOworCXN0cnVjdCBjZ3JvdXBfc3MgKnNzID0gY2dyb3VwX2dldF9zcyh0
eXBlKTsKKwlzdHJ1Y3QgY2dyb3VwX3Jvb3QgKnQ7CisJY2hhciBidWZbQlVGU0laXTsKKworCWlm
ICghb3B0aW9ucykKKwkJb3B0aW9ucyA9ICZkZWZhdWx0X29wdHM7CisKKwlpZiAoc3MtPndlX3Jl
cXVpcmVfaXQpCisJCXRzdF9yZXMoVFdBUk4sICJEdXBsaWNhdGUgdHN0X2Nncm91cF9yZXF1aXJl
KCVzLCApIiwgc3MtPm5hbWUpOworCXNzLT53ZV9yZXF1aXJlX2l0ID0gMTsKKworCWlmIChzcy0+
dHJlZSkKKwkJZ290byBsdHBkaXI7CisKKwl0c3RfY2dyb3VwX3NjYW4oKTsKKworCWlmIChzcy0+
dHJlZSkKKwkJZ290byBsdHBkaXI7CisKKwlpZiAoIWNncm91cF92Ml9tb3VudGVkKCkgJiYgIW9w
dGlvbnMtPm9ubHlfbW91bnRfdjEpCisJCWNncm91cF9tb3VudF92MigpOwogCi0JU0FGRV9NS0RJ
UihtbnRfcGF0aCwgMDc3Nyk7Ci0JaWYgKG1vdW50KCJjZ3JvdXAyIiwgbW50X3BhdGgsICJjZ3Jv
dXAyIiwgMCwgTlVMTCkgPT0gLTEpIHsKLQkJaWYgKGVycm5vID09IEVOT0RFVikgewotCQkJaWYg
KHJtZGlyKG1udF9wYXRoKSA9PSAtMSkKLQkJCQl0c3RfcmVzKFRXQVJOIHwgVEVSUk5PLCAicm1k
aXIgJXMgZmFpbGVkIiwgbW50X3BhdGgpOworCWlmIChzcy0+dHJlZSkKKwkJZ290byBsdHBkaXI7
CisKKwljZ3JvdXBfbW91bnRfdjEodHlwZSk7CisKKwlpZiAoIXNzLT50cmVlKSB7CisJCXRzdF9i
cmsoVENPTkYsCisJCQkiJyVzJyBjb250cm9sbGVyIHJlcXVpcmVkLCBidXQgbm90IGF2YWlsYWJs
ZSIsIHNzLT5uYW1lKTsKKwl9CisKK2x0cGRpcjoKKwl0ID0gc3MtPnRyZWU7CisJYWRkX2Nzcygm
dC0+bW50LnNzX2ZpZWxkLCAxLCB0eXBlKTsKKworCWlmIChjZ3JvdXBfc3Nfb25fdjIoc3MpICYm
IHQtPndlX21vdW50ZWRfaXQpIHsKKwkJU0FGRV9GSUxFX1BSSU5URkFUKHQtPm1udC5kaXIsIGNn
c2MsICIrJXMiLCBzcy0+bmFtZSk7CisJfSBlbHNlIGlmIChjZ3JvdXBfc3Nfb25fdjIoc3MpKSB7
CisJCVNBRkVfRklMRV9SRUFEQVQodC0+bW50LmRpciwgY2dzYywgYnVmLCBzaXplb2YoYnVmKSk7
CisJCWlmICghc3Ryc3RyKGJ1Ziwgc3MtPm5hbWUpKSB7CiAJCQl0c3RfYnJrKFRDT05GLAotCQkJ
CSAiQ2dyb3VwIHYyIGlzIG5vdCBjb25maWd1cmVkIGluIGtlcm5lbCIpOworCQkJCSInJXMnIGNv
bnRyb2xsZXIgcmVxdWlyZWQsIGJ1dCBub3QgaW4gJXMvJXMiLAorCQkJCXNzLT5uYW1lLCB0LT5w
YXRoLCBjZ3NjKTsKIAkJfQotCQl0c3RfYnJrKFRCUk9LIHwgVEVSUk5PLCAibW91bnQgJXMiLCBt
bnRfcGF0aCk7CiAJfQogCi1vdXQ6Ci0JU0FGRV9NS0RJUihuZXdfcGF0aCwgMDc3Nyk7CisJaWYg
KCF0LT5sdHAuZGlyKQorCQl0c3RfY2dyb3VwX3RyZWVfbWsoJnQtPm1udCwgbHRwX2Nncm91cF9k
aXIsICZ0LT5sdHApOworCWVsc2UKKwkJdC0+bHRwLnNzX2ZpZWxkIHw9IHQtPm1udC5zc19maWVs
ZDsKKworCWlmICghdC0+bHRwLndlX2NyZWF0ZWRfaXQpCisJCWdvdG8gdGVzdGRpcjsKKworCWlm
IChjZ3JvdXBfc3Nfb25fdjIoc3MpKSB7CisJCVNBRkVfRklMRV9QUklOVEZBVCh0LT5sdHAuZGly
LCBjZ3NjLCAiKyVzIiwgc3MtPm5hbWUpOworCX0gZWxzZSB7CisJCVNBRkVfRklMRV9QUklOVEZB
VCh0LT5sdHAuZGlyLCAiY2dyb3VwLmNsb25lX2NoaWxkcmVuIiwKKwkJCQkgICAiJWQiLCAxKTsK
KworCQlpZiAodHlwZSA9PSBUU1RfQ0dST1VQX0NQVVNFVCkKKwkJCWNncm91cF9jb3B5X2NwdXNl
dCh0KTsKKwl9CisKK3Rlc3RkaXI6CisJdHN0X2Nncm91cF90cmVlX21rKCZ0LT5sdHAsIGx0cF9j
Z3JvdXBfZHJhaW5fZGlyLCAmdC0+ZHJhaW4pOwogCi0JdHN0X3JlcyhUSU5GTywgIkNncm91cCB2
MiBtb3VudCBhdCAlcyBzdWNjZXNzIiwgbW50X3BhdGgpOworCXNwcmludGYodGVzdF9jZ3JvdXBf
ZGlyLCAidGVzdC0lZCIsIGdldHBpZCgpKTsKKwl0c3RfY2dyb3VwX3RyZWVfbWsoJnQtPmx0cCwg
dGVzdF9jZ3JvdXBfZGlyLCAmdC0+dGVzdCk7CiB9CiAKLXN0YXRpYyB2b2lkIHRzdF9jZ3JvdXBO
X3Vtb3VudChjb25zdCBjaGFyICptbnRfcGF0aCwgY29uc3QgY2hhciAqbmV3X3BhdGgpCitzdGF0
aWMgdm9pZCBjZ3JvdXBfZHJhaW4oZW51bSB0c3RfY2dyb3VwX3ZlciB2ZXIsIGludCBzb3VyY2Us
IGludCBkZXN0KQogewotCUZJTEUgKmZwOworCWNoYXIgYnVmW0JVRlNJWl07CisJY2hhciAqdG9r
OworCWNvbnN0IGNoYXIgKmZuYW1lID0gdmVyID09IFRTVF9DR1JPVVBfVjEgPyAidGFza3MiIDog
ImNncm91cC5wcm9jcyI7CiAJaW50IGZkOwotCWNoYXIgc19uZXdbQlVGU0laXSwgc1tCVUZTSVpd
LCB2YWx1ZVtCVUZTSVpdOwotCWNoYXIga25vYl9wYXRoW1BBVEhfTUFYXTsKKwlzc2l6ZV90IHJl
dDsKIAotCWlmICghdHN0X2lzX21vdW50ZWQobW50X3BhdGgpKQorCXJldCA9IFNBRkVfRklMRV9S
RUFEQVQoc291cmNlLCBmbmFtZSwgYnVmLCBzaXplb2YoYnVmKSk7CisJaWYgKHJldCA8IDApCiAJ
CXJldHVybjsKIAotCS8qIE1vdmUgYWxsIHByb2Nlc3NlcyBpbiB0YXNrKHYyOiBjZ3JvdXAucHJv
Y3MpIHRvIGl0cyBwYXJlbnQgbm9kZS4gKi8KLQlpZiAodHN0X2NnX3ZlciAmIFRTVF9DR1JPVVBf
VjEpCi0JCXNwcmludGYocywgIiVzL3Rhc2tzIiwgbW50X3BhdGgpOwotCWlmICh0c3RfY2dfdmVy
ICYgVFNUX0NHUk9VUF9WMikKLQkJc3ByaW50ZihzLCAiJXMvY2dyb3VwLnByb2NzIiwgbW50X3Bh
dGgpOwotCi0JZmQgPSBvcGVuKHMsIE9fV1JPTkxZKTsKLQlpZiAoZmQgPT0gLTEpCi0JCXRzdF9y
ZXMoVFdBUk4gfCBURVJSTk8sICJvcGVuICVzIiwgcyk7Ci0KLQlpZiAodHN0X2NnX3ZlciAmIFRT
VF9DR1JPVVBfVjEpCi0JCXNucHJpbnRmKHNfbmV3LCBCVUZTSVosICIlcy90YXNrcyIsIG5ld19w
YXRoKTsKLQlpZiAodHN0X2NnX3ZlciAmIFRTVF9DR1JPVVBfVjIpCi0JCXNucHJpbnRmKHNfbmV3
LCBCVUZTSVosICIlcy9jZ3JvdXAucHJvY3MiLCBuZXdfcGF0aCk7Ci0KLQlmcCA9IGZvcGVuKHNf
bmV3LCAiciIpOwotCWlmIChmcCA9PSBOVUxMKQotCQl0c3RfcmVzKFRXQVJOIHwgVEVSUk5PLCAi
Zm9wZW4gJXMiLCBzX25ldyk7Ci0JaWYgKChmZCAhPSAtMSkgJiYgKGZwICE9IE5VTEwpKSB7Ci0J
CXdoaWxlIChmZ2V0cyh2YWx1ZSwgQlVGU0laLCBmcCkgIT0gTlVMTCkKLQkJCWlmICh3cml0ZShm
ZCwgdmFsdWUsIHN0cmxlbih2YWx1ZSkgLSAxKQotCQkJICAgICE9IChzc2l6ZV90KXN0cmxlbih2
YWx1ZSkgLSAxKQotCQkJCXRzdF9yZXMoVFdBUk4gfCBURVJSTk8sICJ3cml0ZSAlcyIsIHMpOwot
CX0KLQlpZiAodHN0X2NnX3ZlciAmIFRTVF9DR1JPVVBfVjEpIHsKLQkJc3ByaW50Zihrbm9iX3Bh
dGgsICIlcy9jcHVzZXQuY3B1cyIsIG1udF9wYXRoKTsKLQkJaWYgKCFhY2Nlc3Moa25vYl9wYXRo
LCBGX09LKSkgewotCQkJc3ByaW50Zihrbm9iX3BhdGgsICIlcy9jZ3JvdXAuY2xvbmVfY2hpbGRy
ZW4iLCBtbnRfcGF0aCk7Ci0JCQlTQUZFX0ZJTEVfUFJJTlRGKGtub2JfcGF0aCwgIiVkIiwgY2xv
bmVfY2hpbGRyZW4pOwotCQl9CisJZmQgPSBTQUZFX09QRU5BVChkZXN0LCBmbmFtZSwgT19XUk9O
TFkpOworCWlmIChmZCA8IDApCisJCXJldHVybjsKKworCWZvciAodG9rID0gc3RydG9rKGJ1Ziwg
IlxuIik7IHRvazsgdG9rID0gc3RydG9rKE5VTEwsICJcbiIpKSB7CisJCXJldCA9IGRwcmludGYo
ZmQsICIlcyIsIHRvayk7CisKKwkJaWYgKHJldCA8IChzc2l6ZV90KXN0cmxlbih0b2spKQorCQkJ
dHN0X2JyayhUQlJPSyB8IFRFUlJOTywgIkZhaWxlZCB0byBkcmFpbiAlcyIsIHRvayk7CiAJfQot
CWlmIChmZCAhPSAtMSkKLQkJY2xvc2UoZmQpOwotCWlmIChmcCAhPSBOVUxMKQotCQlmY2xvc2Uo
ZnApOwotCWlmIChybWRpcihuZXdfcGF0aCkgPT0gLTEpCi0JCXRzdF9yZXMoVFdBUk4gfCBURVJS
Tk8sICJybWRpciAlcyIsIG5ld19wYXRoKTsKLQlpZiAodW1vdW50KG1udF9wYXRoKSA9PSAtMSkK
LQkJdHN0X3JlcyhUV0FSTiB8IFRFUlJOTywgInVtb3VudCAlcyIsIG1udF9wYXRoKTsKLQlpZiAo
cm1kaXIobW50X3BhdGgpID09IC0xKQotCQl0c3RfcmVzKFRXQVJOIHwgVEVSUk5PLCAicm1kaXIg
JXMiLCBtbnRfcGF0aCk7Ci0KLQlpZiAodHN0X2NnX3ZlciAmIFRTVF9DR1JPVVBfVjEpCi0JCXRz
dF9yZXMoVElORk8sICJDZ3JvdXAgdjEgdW5tb3VudCBzdWNjZXNzIik7Ci0JaWYgKHRzdF9jZ192
ZXIgJiBUU1RfQ0dST1VQX1YyKQotCQl0c3RfcmVzKFRJTkZPLCAiQ2dyb3VwIHYyIHVubW91bnQg
c3VjY2VzcyIpOwotfQotCi1zdHJ1Y3QgdHN0X2Nncm91cF9wYXRoIHsKLQljaGFyICptbnRfcGF0
aDsKLQljaGFyICpuZXdfcGF0aDsKLQlzdHJ1Y3QgdHN0X2Nncm91cF9wYXRoICpuZXh0OwotfTsK
KwlTQUZFX0NMT1NFKGZkKTsKK30KIAotc3RhdGljIHN0cnVjdCB0c3RfY2dyb3VwX3BhdGggKnRz
dF9jZ3JvdXBfcGF0aHM7CitzdGF0aWMgdm9pZCBjbG9zZV9wYXRoX2ZkcyhzdHJ1Y3QgY2dyb3Vw
X3Jvb3QgKnQpCit7CisJaWYgKHQtPnRlc3QuZGlyID4gMCkKKwkJU0FGRV9DTE9TRSh0LT50ZXN0
LmRpcik7CisJaWYgKHQtPmx0cC5kaXIgPiAwKQorCQlTQUZFX0NMT1NFKHQtPmx0cC5kaXIpOwor
CWlmICh0LT5kcmFpbi5kaXIgPiAwKQorCQlTQUZFX0NMT1NFKHQtPmRyYWluLmRpcik7CisJaWYg
KHQtPm1udC5kaXIgPiAwKQorCQlTQUZFX0NMT1NFKHQtPm1udC5kaXIpOworfQogCi1zdGF0aWMg
dm9pZCB0c3RfY2dyb3VwX3NldF9wYXRoKGNvbnN0IGNoYXIgKmNncm91cF9kaXIpCisvKiBNYXli
ZSByZW1vdmUgQ0dyb3VwcyB1c2VkIGR1cmluZyB0ZXN0aW5nIGFuZCBjbGVhciBvdXIgZGF0YQor
ICoKKyAqIFRoaXMgd2lsbCBuZXZlciByZW1vdmUgQ0dyb3VwcyB3ZSBkaWQgbm90IGNyZWF0ZSB0
byBhbGxvdyB0ZXN0cyB0bworICogYmUgcnVuIGluIHBhcmFsbGVsIChzZWUgZW51bSB0c3RfY2dy
b3VwX2NsZWFudXApLgorICoKKyAqIEVhY2ggdGVzdCBwcm9jZXNzIGlzIGdpdmVuIGl0cyBvd24g
dW5pcXVlIENHcm91cC4gVW5sZXNzIHdlIHdhbnQgdG8KKyAqIHN0cmVzcyB0ZXN0IHRoZSBDR3Jv
dXAgc3lzdGVtLiBXZSBzaG91bGQgYXQgbGVhc3QgcmVtb3ZlIHRoZXNlCisgKiB1bmlxdWUgdGVz
dCBDR3JvdXBzLgorICoKKyAqIFdlIHByb2JhYmx5IGFsc28gd2FudCB0byByZW1vdmUgdGhlIExU
UCBwYXJlbnQgQ0dyb3VwLCBhbHRob3VnaAorICogdGhpcyBtYXkgaGF2ZSBiZWVuIGNyZWF0ZWQg
YnkgdGhlIHN5c3RlbSBtYW5hZ2VyIG9yIGFub3RoZXIgdGVzdAorICogKHNlZSBub3RlcyBvbiBw
YXJhbGxlbCB0ZXN0aW5nKS4KKyAqCisgKiBPbiBzeXN0ZW1zIHdpdGggbm8gaW5pdGlhbCBDR3Jv
dXAgc2V0dXAgd2UgbWF5IHRyeSB0byBkZXN0cm95IHRoZQorICogQ0dyb3VwIHJvb3RzIHdlIG1v
dW50ZWQgc28gdGhhdCB0aGV5IGNhbiBiZSByZWNyZWF0ZWQgYnkgYW5vdGhlcgorICogdGVzdC4g
Tm90ZSB0aGF0IHN1Y2Nlc3NmdWxseSB1bm1vdW50aW5nIGEgQ0dyb3VwIHJvb3QgZG9lcyBub3QK
KyAqIG5lY2Vzc2FyaWx5IGluZGljYXRlIHRoYXQgaXQgd2FzIGRlc3Ryb3llZC4KKyAqCisgKiBU
aGUgbHRwL2RyYWluIENHcm91cCBpcyByZXF1aXJlZCBmb3IgY2xlYW5pbmcgdXAgdGVzdCBDR3Jv
dXBzIHdoZW4KKyAqIHdlIGNhbiBub3QgbW92ZSB0aGVtIHRvIHRoZSByb290IENHcm91cC4gQ0dy
b3VwcyBjYW4gb25seSBiZQorICogcmVtb3ZlZCB3aGVuIHRoZXkgaGF2ZSBubyBtZW1iZXJzIGFu
ZCBvbmx5IGxlYWYgb3Igcm9vdCBDR3JvdXBzIG1heQorICogaGF2ZSBwcm9jZXNzZXMgd2l0aGlu
IHRoZW0uIEFzIHRlc3QgcHJvY2Vzc2VzIGNyZWF0ZSBhbmQgZGVzdHJveQorICogdGhlaXIgb3du
IENHcm91cHMgdGhleSBtdXN0IG1vdmUgdGhlbXNlbHZlcyBlaXRoZXIgdG8gcm9vdCBvcgorICog
YW5vdGhlciBsZWFmIENHcm91cC4gU28gd2UgbW92ZSB0aGVtIHRvIGRyYWluIHdoaWxlIGRlc3Ry
b3lpbmcgdGhlCisgKiB1bmlxdWUgdGVzdCBDR3JvdXAuCisgKgorICogSWYgd2UgaGF2ZSBhY2Nl
c3MgdG8gcm9vdCBhbmQgY3JlYXRlZCB0aGUgTFRQIENHcm91cCB3ZSB0aGVuIG1vdmUKKyAqIHRo
ZSB0ZXN0IHByb2Nlc3MgdG8gcm9vdCBhbmQgZGVzdHJveSB0aGUgZHJhaW4gYW5kIExUUAorICog
Q0dyb3Vwcy4gT3RoZXJ3aXNlIHdlIGp1c3QgbGVhdmUgdGhlIHRlc3QgcHJvY2VzcyB0byBkaWUg
aW4gdGhlCisgKiBkcmFpbiwgbXVjaCBsaWtlIG1hbnkgYSB1bndhbnRlZCB0ZXJyYXBpbi4KKyAq
CisgKiBGaW5hbGx5IHdlIGNsZWFyIGFueSBkYXRhIHdlIGhhdmUgY29sbGVjdGVkIG9uIENHcm91
cHMuIFRoaXMgd2lsbAorICogaGFwcGVuIHJlZ2FyZGxlc3Mgb2Ygd2hldGhlciBhbnl0aGluZyB3
YXMgcmVtb3ZlZC4KKyAqLwordm9pZCB0c3RfY2dyb3VwX2NsZWFudXAodm9pZCkKIHsKLQljaGFy
IGNncm91cF9uZXdfZGlyW1BBVEhfTUFYXTsKLQlzdHJ1Y3QgdHN0X2Nncm91cF9wYXRoICp0c3Rf
Y2dyb3VwX3BhdGgsICphOworCXN0cnVjdCBjZ3JvdXBfcm9vdCAqdDsKKwlzdHJ1Y3QgY2dyb3Vw
X3NzICpzczsKIAotCWlmICghY2dyb3VwX2RpcikKLQkJdHN0X2JyayhUQlJPSywgIkludmFsaWQg
Y2dyb3VwIGRpciwgcGxlc2UgY2hlY2sgY2dyb3VwX2RpciIpOworCWlmICghY2dyb3VwX21vdW50
ZWQoKSkKKwkJZ290byBjbGVhcl9kYXRhOwogCi0Jc3ByaW50ZihjZ3JvdXBfbmV3X2RpciwgIiVz
L2x0cF8lZCIsIGNncm91cF9kaXIsIHJhbmQoKSk7CisJZm9yX2VhY2hfcm9vdCh0KSB7CisJCWlm
ICghdC0+dGVzdC5sb2MubmFtZSkKKwkJCWNvbnRpbnVlOwogCi0JLyogVG8gc3RvcmUgY2dyb3Vw
IHBhdGggaW4gdGhlICdwYXRoJyBsaXN0ICovCi0JdHN0X2Nncm91cF9wYXRoID0gU0FGRV9NQUxM
T0Moc2l6ZW9mKHN0cnVjdCB0c3RfY2dyb3VwX3BhdGgpKTsKLQl0c3RfY2dyb3VwX3BhdGgtPm1u
dF9wYXRoID0gU0FGRV9NQUxMT0Moc3RybGVuKGNncm91cF9kaXIpICsgMSk7Ci0JdHN0X2Nncm91
cF9wYXRoLT5uZXdfcGF0aCA9IFNBRkVfTUFMTE9DKHN0cmxlbihjZ3JvdXBfbmV3X2RpcikgKyAx
KTsKLQl0c3RfY2dyb3VwX3BhdGgtPm5leHQgPSBOVUxMOworCQljZ3JvdXBfZHJhaW4odC0+dmVy
LCB0LT50ZXN0LmRpciwgdC0+ZHJhaW4uZGlyKTsKKwkJU0FGRV9VTkxJTktBVCh0LT5sdHAuZGly
LCB0LT50ZXN0LmxvYy5uYW1lLCBBVF9SRU1PVkVESVIpOworCX0KIAotCWlmICghdHN0X2Nncm91
cF9wYXRocykgewotCQl0c3RfY2dyb3VwX3BhdGhzID0gdHN0X2Nncm91cF9wYXRoOwotCX0gZWxz
ZSB7Ci0JCWEgPSB0c3RfY2dyb3VwX3BhdGhzOwotCQlkbyB7Ci0JCQlpZiAoIWEtPm5leHQpIHsK
LQkJCQlhLT5uZXh0ID0gdHN0X2Nncm91cF9wYXRoOwotCQkJCWJyZWFrOwotCQkJfQotCQkJYSA9
IGEtPm5leHQ7Ci0JCX0gd2hpbGUgKGEpOworCWZvcl9lYWNoX3Jvb3QodCkgeworCQlpZiAoIXQt
Pmx0cC53ZV9jcmVhdGVkX2l0KQorCQkJY29udGludWU7CisKKwkJY2dyb3VwX2RyYWluKHQtPnZl
ciwgdC0+ZHJhaW4uZGlyLCB0LT5tbnQuZGlyKTsKKworCQlpZiAodC0+ZHJhaW4ubG9jLm5hbWUp
CisJCQlTQUZFX1VOTElOS0FUKHQtPmx0cC5kaXIsIHQtPmRyYWluLmxvYy5uYW1lLCBBVF9SRU1P
VkVESVIpOworCisJCWlmICh0LT5sdHAubG9jLm5hbWUpCisJCQlTQUZFX1VOTElOS0FUKHQtPm1u
dC5kaXIsIHQtPmx0cC5sb2MubmFtZSwgQVRfUkVNT1ZFRElSKTsKIAl9CiAKLQlzcHJpbnRmKHRz
dF9jZ3JvdXBfcGF0aC0+bW50X3BhdGgsICIlcyIsIGNncm91cF9kaXIpOwotCXNwcmludGYodHN0
X2Nncm91cF9wYXRoLT5uZXdfcGF0aCwgIiVzIiwgY2dyb3VwX25ld19kaXIpOworCWZvcl9lYWNo
X2NzcyhzcykgeworCQlpZiAoIWNncm91cF9zc19vbl92MihzcykgfHwgIXNzLT50cmVlLT53ZV9t
b3VudGVkX2l0KQorCQkJY29udGludWU7CisKKwkJU0FGRV9GSUxFX1BSSU5URkFUKHNzLT50cmVl
LT5tbnQuZGlyLCAiY2dyb3VwLnN1YnRyZWVfY29udHJvbCIsCisJCQkJICAgIi0lcyIsIHNzLT5u
YW1lKTsKKwl9CisKKwlmb3JfZWFjaF9yb290KHQpIHsKKwkJaWYgKCF0LT53ZV9tb3VudGVkX2l0
KQorCQkJY29udGludWU7CisKKwkJLyogVGhpcyBwcm9iYWJseSBkb2VzIG5vdCByZXN1bHQgaW4g
dGhlIENHcm91cCByb290CisJCSAqIGJlaW5nIGRlc3Ryb3llZCAqLworCQlpZiAodW1vdW50Mih0
LT5wYXRoLCBNTlRfREVUQUNIKSkKKwkJCWNvbnRpbnVlOworCisJCVNBRkVfUk1ESVIodC0+cGF0
aCk7CisJfQorCitjbGVhcl9kYXRhOgorCW1lbXNldChjc3MsIDAsIHNpemVvZihjc3MpKTsKKwor
CWZvcl9lYWNoX3Jvb3QodCkKKwkJY2xvc2VfcGF0aF9mZHModCk7CisKKwltZW1zZXQocm9vdHMs
IDAsIHNpemVvZihyb290cykpOwogfQogCi1zdGF0aWMgY2hhciAqdHN0X2Nncm91cF9nZXRfcGF0
aChjb25zdCBjaGFyICpjZ3JvdXBfZGlyKQorLyogQ0dyb3VwIEl0ZW0gSW1wbGVtZW50YXRpb24g
Ki8KKworc3RhdGljIGludCBjZ3JvdXBfZGVmYXVsdF9leGlzdHMoY29uc3QgY2hhciAqIGZpbGUs
IGNvbnN0IGludCBsaW5lbm8sCisJCQkJIHRzdF9jZ3JvdXBfaXRlbV9wdHIgaXRlbSBMVFBfQVRU
UklCVVRFX1VOVVNFRCkKIHsKLQlzdHJ1Y3QgdHN0X2Nncm91cF9wYXRoICphOworCXRzdF9icmtf
KGZpbGUsIGxpbmVubywgVEJST0ssICJFeGlzdHMgbWV0aG9kIG5vdCBpbXBsZW1lbnRlZCBmb3Ig
aXRlbSIpOworCisJcmV0dXJuIDA7Cit9CiAKLQlpZiAoIXRzdF9jZ3JvdXBfcGF0aHMpCi0JCXJl
dHVybiBOVUxMOworc3RhdGljIGNvbnN0IHN0cnVjdCB0c3RfY2dyb3VwX2l0ZW0gY2dyb3VwX2Rl
ZmF1bHRfaXRlbSA9IHsKKwkuZXhpc3RzID0gY2dyb3VwX2RlZmF1bHRfZXhpc3RzLAorfTsKIAot
CWEgPSB0c3RfY2dyb3VwX3BhdGhzOworc3RhdGljIGludCBjZ3JvdXBfZW50X2V4aXN0cyhjb25z
dCBjaGFyICogZmlsZSwgY29uc3QgaW50IGxpbmVubywKKwkJCSAgICAgY29uc3Qgc3RydWN0IHRz
dF9jZ3JvdXBfbG9jYXRpb24gKmxvYykKK3sKKwlpbnQgZGlyZmQsIHJldDsKIAotCXdoaWxlIChz
dHJjbXAoYS0+bW50X3BhdGgsIGNncm91cF9kaXIpICE9IDApewotCQlpZiAoIWEtPm5leHQpIHsK
LQkJCXRzdF9yZXMoVElORk8sICIlcyBpcyBub3QgZm91bmQiLCBjZ3JvdXBfZGlyKTsKLQkJCXJl
dHVybiBOVUxMOwotCQl9Ci0JCWEgPSBhLT5uZXh0OwotCX07CisJaWYgKCFsb2MtPnRyZWUpCisJ
CXJldHVybiAwOwogCi0JcmV0dXJuIGEtPm5ld19wYXRoOworCWRpcmZkID0gbG9jLT50cmVlLT5k
aXI7CisJcmV0ID0gZmFjY2Vzc2F0KGRpcmZkLCBsb2MtPm5hbWUsIEZfT0ssIDApOworCisJaWYg
KCFyZXQpCisJCXJldHVybiAxOworCisJaWYgKGVycm5vID09IEVOT0VOVCkKKwkJcmV0dXJuIDA7
CisKKwl0c3RfYnJrXyhmaWxlLCBsaW5lbm8sIFRCUk9LIHwgVEVSUk5PLAorCQkgImZhY2Nlc3Nh
dCglZDwlcz4sICVzLCBGX09LLCAwKSIsCisJCSBkaXJmZCwgdHN0X2RlY29kZV9mZChkaXJmZCks
IGxvYy0+bmFtZSk7CisKKwlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHZvaWQgdHN0X2Nncm91cF9k
ZWxfcGF0aChjb25zdCBjaGFyICpjZ3JvdXBfZGlyKQorc3RhdGljIGludCBjZ3JvdXBfZmlsZV9l
eGlzdHMoY29uc3QgY2hhciAqIGZpbGUsIGNvbnN0IGludCBsaW5lbm8sCisJCQkgICAgICB0c3Rf
Y2dyb3VwX2l0ZW1fcHRyIGl0ZW0pCiB7Ci0Jc3RydWN0IHRzdF9jZ3JvdXBfcGF0aCAqYSwgKmI7
CisJY29uc3Qgc3RydWN0IHRzdF9jZ3JvdXBfZmlsZSAqY2dmID0KKwkJdHN0X2NvbnRhaW5lcl9v
ZihpdGVtLCB0eXBlb2YoKmNnZiksIGl0ZW0pOworCXVuc2lnbmVkIGludCBpLCBuID0gY2dmLT5u
OworCWNvbnN0IHN0cnVjdCB0c3RfY2dyb3VwX2xvY2F0aW9uICpsb2MgPSBjZ2YtPmxvY2F0aW9u
czsKIAotCWlmICghdHN0X2Nncm91cF9wYXRocykKLQkJcmV0dXJuOworCWZvciAoaSA9IDA7IGkg
PCBuOyBpKyspIHsKKwkJaWYgKGNncm91cF9lbnRfZXhpc3RzKGZpbGUsIGxpbmVubywgbG9jICsg
aSkpCisJCQlyZXR1cm4gMTsKKwl9CiAKLQlhID0gYiA9IHRzdF9jZ3JvdXBfcGF0aHM7CisJcmV0
dXJuIDA7Cit9CiAKLQl3aGlsZSAoc3RyY21wKGItPm1udF9wYXRoLCBjZ3JvdXBfZGlyKSAhPSAw
KSB7Ci0JCWlmICghYi0+bmV4dCkgewotCQkJdHN0X3JlcyhUSU5GTywgIiVzIGlzIG5vdCBmb3Vu
ZCIsIGNncm91cF9kaXIpOwotCQkJcmV0dXJuOwotCQl9Ci0JCWEgPSBiOwotCQliID0gYi0+bmV4
dDsKLQl9Oworc3RhdGljIGNvbnN0IHN0cnVjdCB0c3RfY2dyb3VwX2l0ZW0gY2dyb3VwX2ZpbGVf
aXRlbSA9IHsKKwkuZXhpc3RzID0gY2dyb3VwX2ZpbGVfZXhpc3RzLAorfTsKIAotCWlmIChiID09
IHRzdF9jZ3JvdXBfcGF0aHMpCi0JCXRzdF9jZ3JvdXBfcGF0aHMgPSBiLT5uZXh0OwotCWVsc2UK
LQkJYS0+bmV4dCA9IGItPm5leHQ7CitzdGF0aWMgdm9pZCBjZ3JvdXBfZmlsZV9pbml0KHN0cnVj
dCB0c3RfY2dyb3VwX2ZpbGUgKmZpbGUpCit7CisJZmlsZS0+aXRlbSA9ICZjZ3JvdXBfZmlsZV9p
dGVtOworCWZpbGUtPm4gPSAwOworfQorCitzdGF0aWMgdm9pZCBjZ3JvdXBfZmlsZV9hZGQoc3Ry
dWN0IHRzdF9jZ3JvdXBfZmlsZSAqZmlsZSwKKwkJCSAgICBjb25zdCBjaGFyICpuYW1lLAorCQkJ
ICAgIGNvbnN0IHN0cnVjdCB0c3RfY2dyb3VwX3RyZWUgKnRyZWUpCit7CisJZmlsZS0+bG9jYXRp
b25zW2ZpbGUtPm5dLm5hbWUgPSBuYW1lOworCWZpbGUtPmxvY2F0aW9uc1tmaWxlLT5uXS50cmVl
ID0gdHJlZTsKKwlmaWxlLT5uKys7Cit9CisKK3N0YXRpYyBpbnQgY2dyb3VwX21lbW9yeV9zd2Fw
X2V4aXN0cyhjb25zdCBjaGFyICogZmlsZSwgY29uc3QgaW50IGxpbmVubywKKwkJCQkgICAgIHRz
dF9jZ3JvdXBfaXRlbV9wdHIgaXRlbSkKK3sKKwljb25zdCBzdHJ1Y3QgdHN0X2Nncm91cF9tZW1v
cnlfc3dhcCAqYyA9CisJCXRzdF9jb250YWluZXJfb2YoaXRlbSwgdHlwZW9mKCpjKSwgaXRlbSk7
CiAKLQlmcmVlKGItPm1udF9wYXRoKTsKLQlmcmVlKGItPm5ld19wYXRoKTsKLQlmcmVlKGIpOwor
CXJldHVybiBjZ3JvdXBfZmlsZV9leGlzdHMoZmlsZSwgbGluZW5vLCAmYy0+bWF4Lml0ZW0pOwog
fQogCi12b2lkIHRzdF9jZ3JvdXBfbW91bnQoZW51bSB0c3RfY2dyb3VwX2N0cmwgY3RybCwgY29u
c3QgY2hhciAqY2dyb3VwX2RpcikKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgdHN0X2Nncm91cF9pdGVt
IGNncm91cF9tZW1vcnlfc3dhcF9pdGVtID0geworCS5leGlzdHMgPSBjZ3JvdXBfbWVtb3J5X3N3
YXBfZXhpc3RzLAorfTsKKworc3RhdGljIGludCBjZ3JvdXBfbWVtb3J5X2ttZW1fZXhpc3RzKGNv
bnN0IGNoYXIgKiBmaWxlLCBjb25zdCBpbnQgbGluZW5vLAorCQkJCSAgICAgdHN0X2Nncm91cF9p
dGVtX3B0ciBpdGVtKQogewotCWNoYXIgKmNncm91cF9uZXdfZGlyOwotCWNoYXIga25vYl9wYXRo
W1BBVEhfTUFYXTsKKwljb25zdCBzdHJ1Y3QgdHN0X2Nncm91cF9tZW1vcnlfa21lbSAqYyA9CisJ
CXRzdF9jb250YWluZXJfb2YoaXRlbSwgdHlwZW9mKCpjKSwgaXRlbSk7CiAKLQl0c3RfY2dfdmVy
ID0gdHN0X2Nncm91cF92ZXJzaW9uKCk7CisJcmV0dXJuIGNncm91cF9maWxlX2V4aXN0cyhmaWxl
LCBsaW5lbm8sICZjLT5tYXguaXRlbSk7Cit9CiAKLQl0c3RfY2dyb3VwX3NldF9wYXRoKGNncm91
cF9kaXIpOwotCWNncm91cF9uZXdfZGlyID0gdHN0X2Nncm91cF9nZXRfcGF0aChjZ3JvdXBfZGly
KTsKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgdHN0X2Nncm91cF9pdGVtIGNncm91cF9tZW1vcnlfa21l
bV9pdGVtID0geworCS5leGlzdHMgPSBjZ3JvdXBfbWVtb3J5X2ttZW1fZXhpc3RzLAorfTsKIAot
CWlmICh0c3RfY2dfdmVyICYgVFNUX0NHUk9VUF9WMSkgewotCQlzd2l0Y2goY3RybCkgewotCQlj
YXNlIFRTVF9DR1JPVVBfTUVNQ0c6Ci0JCQl0c3RfY2dyb3VwMV9tb3VudCgibWVtY2ciLCAibWVt
b3J5IiwgY2dyb3VwX2RpciwgY2dyb3VwX25ld19kaXIpOwotCQlicmVhazsKLQkJY2FzZSBUU1Rf
Q0dST1VQX0NQVVNFVDoKLQkJCXRzdF9jZ3JvdXAxX21vdW50KCJjcHVzZXRjZyIsICJjcHVzZXQi
LCBjZ3JvdXBfZGlyLCBjZ3JvdXBfbmV3X2Rpcik7Ci0JCWJyZWFrOwotCQlkZWZhdWx0OgotCQkJ
dHN0X2JyayhUQlJPSywgIkludmFsaWQgY2dyb3VwIGNvbnRyb2xsZXI6ICVkIiwgY3RybCk7Ci0J
CX0KK3N0YXRpYyBpbnQgY2dyb3VwX21lbW9yeV9leGlzdHMoY29uc3QgY2hhciAqIGZpbGUsIGNv
bnN0IGludCBsaW5lbm8sCisJCQkJdHN0X2Nncm91cF9pdGVtX3B0ciBpdGVtKQoreworCWNvbnN0
IHN0cnVjdCB0c3RfY2dyb3VwX21lbW9yeSAqYyA9CisJCXRzdF9jb250YWluZXJfb2YoaXRlbSwg
dHlwZW9mKCpjKSwgaXRlbSk7CisKKwlyZXR1cm4gY2dyb3VwX2ZpbGVfZXhpc3RzKGZpbGUsIGxp
bmVubywgJmMtPm1heC5pdGVtKTsKK30KKworc3RhdGljIHN0cnVjdCB0c3RfY2dyb3VwX2l0ZW0g
Y2dyb3VwX21lbW9yeV9pdGVtID0geworCS5leGlzdHMgPSBjZ3JvdXBfbWVtb3J5X2V4aXN0cywK
K307CisKK3N0YXRpYyB2b2lkIGNncm91cF9tZW1vcnlfaW5pdChzdHJ1Y3QgdHN0X2Nncm91cF9t
ZW1vcnkgKmNnbSkKK3sKKwljZ20tPml0ZW0gPSAmY2dyb3VwX21lbW9yeV9pdGVtOworCWNnbS0+
dmVyID0gMDsKKwljZ3JvdXBfZmlsZV9pbml0KCZjZ20tPmN1cnJlbnQpOworCWNncm91cF9maWxl
X2luaXQoJmNnbS0+bWF4KTsKKwljZ3JvdXBfZmlsZV9pbml0KCZjZ20tPnN3YXBwaW5lc3MpOwor
CisJY2dtLT5zd2FwLml0ZW0gPSAmY2dyb3VwX21lbW9yeV9zd2FwX2l0ZW07CisJY2dyb3VwX2Zp
bGVfaW5pdCgmY2dtLT5zd2FwLmN1cnJlbnQpOworCWNncm91cF9maWxlX2luaXQoJmNnbS0+c3dh
cC5tYXgpOworCisJY2dtLT5rbWVtLml0ZW0gPSAmY2dyb3VwX21lbW9yeV9rbWVtX2l0ZW07CisJ
Y2dyb3VwX2ZpbGVfaW5pdCgmY2dtLT5rbWVtLmN1cnJlbnQpOworCWNncm91cF9maWxlX2luaXQo
JmNnbS0+a21lbS5tYXgpOworfQorCitzdGF0aWMgdm9pZCBjZ3JvdXBfbWVtb3J5X2FkZChzdHJ1
Y3QgdHN0X2Nncm91cF9tZW1vcnkgKmNnbSwKKwkJCSAgICAgIGNvbnN0IHN0cnVjdCB0c3RfY2dy
b3VwX3RyZWUgKnRyZWUpCit7CisJY29uc3QgY2hhciAqY3VycmVudCwgKm1heCwgKnN3YXBfY3Vy
cmVudCwgKnN3YXBfbWF4OworCisJY2dtLT52ZXIgPSB0cmVlLT5yb290LT52ZXI7CisKKwljZ3Jv
dXBfZmlsZV9hZGQoJmNnbS0+a21lbS5jdXJyZW50LCAibWVtb3J5LmttZW0udXNhZ2VfaW5fYnl0
ZXMiLCB0cmVlKTsKKwljZ3JvdXBfZmlsZV9hZGQoJmNnbS0+a21lbS5tYXgsICJtZW1vcnkua21l
bS5saW1pdF9pbl9ieXRlcyIsIHRyZWUpOworCisJaWYgKHRyZWUtPnJvb3QtPnZlciA9PSBUU1Rf
Q0dST1VQX1YxKSB7CisJCWN1cnJlbnQgPSAibWVtb3J5LnVzYWdlX2luX2J5dGVzIjsKKwkJbWF4
ID0gIm1lbW9yeS5saW1pdF9pbl9ieXRlcyI7CisJCXN3YXBfY3VycmVudCA9ICJtZW1vcnkubWVt
c3cudXNhZ2VfaW5fYnl0ZXMiOworCQlzd2FwX21heCA9ICJtZW1vcnkubWVtc3cubGltaXRfaW5f
Ynl0ZXMiOworCX0gZWxzZSB7CisJCWN1cnJlbnQgPSAibWVtb3J5LmN1cnJlbnQiOworCQltYXgg
PSAibWVtb3J5Lm1heCI7CisJCXN3YXBfY3VycmVudCA9ICJtZW1vcnkuc3dhcC5jdXJyZW50IjsK
KwkJc3dhcF9tYXggPSAibWVtb3J5LnN3YXAubWF4IjsKIAl9CiAKLQlpZiAodHN0X2NnX3ZlciAm
IFRTVF9DR1JPVVBfVjIpIHsKLQkJdHN0X2Nncm91cDJfbW91bnQoY2dyb3VwX2RpciwgY2dyb3Vw
X25ld19kaXIpOworCWNncm91cF9maWxlX2FkZCgmY2dtLT5jdXJyZW50LCBjdXJyZW50LCB0cmVl
KTsKKwljZ3JvdXBfZmlsZV9hZGQoJmNnbS0+bWF4LCBtYXgsIHRyZWUpOworCWNncm91cF9maWxl
X2FkZCgmY2dtLT5zd2FwcGluZXNzLCAibWVtb3J5LnN3YXBwaW5lc3MiLCB0cmVlKTsKIAotCQlz
d2l0Y2goY3RybCkgewotCQljYXNlIFRTVF9DR1JPVVBfTUVNQ0c6Ci0JCQlzcHJpbnRmKGtub2Jf
cGF0aCwgIiVzL2Nncm91cC5zdWJ0cmVlX2NvbnRyb2wiLCBjZ3JvdXBfZGlyKTsKLQkJCVNBRkVf
RklMRV9QUklOVEYoa25vYl9wYXRoLCAiJXMiLCAiK21lbW9yeSIpOwotCQlicmVhazsKLQkJY2Fz
ZSBUU1RfQ0dST1VQX0NQVVNFVDoKLQkJCXRzdF9icmsoVENPTkYsICJDZ3JvdXAgdjIgaGFzbid0
IGFjaGlldmUgY3B1c2V0IHN1YnN5c3RlbSIpOwotCQlicmVhazsKLQkJZGVmYXVsdDoKLQkJCXRz
dF9icmsoVEJST0ssICJJbnZhbGlkIGNncm91cCBjb250cm9sbGVyOiAlZCIsIGN0cmwpOwotCQl9
CisJY2dyb3VwX2ZpbGVfYWRkKCZjZ20tPnN3YXAuY3VycmVudCwgc3dhcF9jdXJyZW50LCB0cmVl
KTsKKwljZ3JvdXBfZmlsZV9hZGQoJmNnbS0+c3dhcC5tYXgsIHN3YXBfbWF4LCB0cmVlKTsKK30K
Kworc3RhdGljIGludCBjZ3JvdXBfY3B1c2V0X2V4aXN0cyhjb25zdCBjaGFyICogZmlsZSwgY29u
c3QgaW50IGxpbmVubywKKwkJCQl0c3RfY2dyb3VwX2l0ZW1fcHRyIGl0ZW0pCit7CisJY29uc3Qg
c3RydWN0IHRzdF9jZ3JvdXBfY3B1c2V0ICpjID0KKwkJdHN0X2NvbnRhaW5lcl9vZihpdGVtLCB0
eXBlb2YoKmMpLCBpdGVtKTsKKworCXJldHVybiBjZ3JvdXBfZmlsZV9leGlzdHMoZmlsZSwgbGlu
ZW5vLCAmYy0+Y3B1cy5pdGVtKTsKK30KKworc3RhdGljIHN0cnVjdCB0c3RfY2dyb3VwX2l0ZW0g
Y2dyb3VwX2NwdXNldF9pdGVtID0geworCS5leGlzdHMgPSBjZ3JvdXBfY3B1c2V0X2V4aXN0cywK
K307CisKK3N0YXRpYyB2b2lkIGNncm91cF9jcHVzZXRfaW5pdChzdHJ1Y3QgdHN0X2Nncm91cF9j
cHVzZXQgKmNnYykKK3sKKwljZ2MtPml0ZW0gPSAmY2dyb3VwX2NwdXNldF9pdGVtOworCWNnYy0+
dmVyID0gMDsKKworCWNncm91cF9maWxlX2luaXQoJmNnYy0+Y3B1cyk7CisJY2dyb3VwX2ZpbGVf
aW5pdCgmY2djLT5tZW1zKTsKKworCWNncm91cF9maWxlX2luaXQoJmNnYy0+bWVtb3J5X21pZ3Jh
dGUpOworfQorCitzdGF0aWMgdm9pZCBjZ3JvdXBfY3B1c2V0X2FkZChzdHJ1Y3QgdHN0X2Nncm91
cF9jcHVzZXQgKmNnYywKKwkJCSAgICAgIGNvbnN0IHN0cnVjdCB0c3RfY2dyb3VwX3RyZWUgKnRy
ZWUpCit7CisJY29uc3QgY2hhciAqY3B1cywgKm1lbXMsICptZW1vcnlfbWlncmF0ZTsKKworCWNn
Yy0+dmVyID0gdHJlZS0+cm9vdC0+dmVyOworCisJaWYgKHRyZWUtPnJvb3QtPm5vX3ByZWZpeCkg
eworCQljcHVzID0gImNwdXMiOworCQltZW1zID0gIm1lbXMiOworCQltZW1vcnlfbWlncmF0ZSA9
ICJtZW1vcnlfbWlncmF0ZSI7CisJfSBlbHNlIHsKKwkJY3B1cyA9ICJjcHVzZXQuY3B1cyI7CisJ
CW1lbXMgPSAiY3B1c2V0Lm1lbXMiOworCQltZW1vcnlfbWlncmF0ZSA9ICJjcHVzZXQubWVtb3J5
X21pZ3JhdGUiOwogCX0KKworCWNncm91cF9maWxlX2FkZCgmY2djLT5jcHVzLCBjcHVzLCB0cmVl
KTsKKwljZ3JvdXBfZmlsZV9hZGQoJmNnYy0+bWVtcywgbWVtcywgdHJlZSk7CisJY2dyb3VwX2Zp
bGVfYWRkKCZjZ2MtPm1lbW9yeV9taWdyYXRlLCBtZW1vcnlfbWlncmF0ZSwgdHJlZSk7CiB9CiAK
LXZvaWQgdHN0X2Nncm91cF91bW91bnQoY29uc3QgY2hhciAqY2dyb3VwX2RpcikKK3N0YXRpYyB2
b2lkIGNncm91cF9jZ3JvdXBfaW5pdChzdHJ1Y3QgdHN0X2Nncm91cF9jZ3JvdXAgKmNnZykKIHsK
LQljaGFyICpjZ3JvdXBfbmV3X2RpcjsKKwljZ2ctPml0ZW0gPSAmY2dyb3VwX2RlZmF1bHRfaXRl
bTsKIAotCWNncm91cF9uZXdfZGlyID0gdHN0X2Nncm91cF9nZXRfcGF0aChjZ3JvdXBfZGlyKTsK
LQl0c3RfY2dyb3VwTl91bW91bnQoY2dyb3VwX2RpciwgY2dyb3VwX25ld19kaXIpOwotCXRzdF9j
Z3JvdXBfZGVsX3BhdGgoY2dyb3VwX2Rpcik7CisJY2dyb3VwX2ZpbGVfaW5pdCgmY2dnLT5wcm9j
cyk7CisJY2dyb3VwX2ZpbGVfaW5pdCgmY2dnLT5jbG9uZV9jaGlsZHJlbik7CisJY2dyb3VwX2Zp
bGVfaW5pdCgmY2dnLT5zdWJ0cmVlX2NvbnRyb2wpOwogfQogCi12b2lkIHRzdF9jZ3JvdXBfc2V0
X2tub2IoY29uc3QgY2hhciAqY2dyb3VwX2RpciwgY29uc3QgY2hhciAqa25vYiwgbG9uZyB2YWx1
ZSkKK3N0YXRpYyB2b2lkIGNncm91cF9jZ3JvdXBfYWRkKHN0cnVjdCB0c3RfY2dyb3VwX2Nncm91
cCAqY2dnLAorCQkJICAgICAgY29uc3Qgc3RydWN0IHRzdF9jZ3JvdXBfdHJlZSAqdHJlZSkKIHsK
LQljaGFyICpjZ3JvdXBfbmV3X2RpcjsKLQljaGFyIGtub2JfcGF0aFtQQVRIX01BWF07CisJaWYg
KHRyZWUtPnJvb3QtPnZlciA9PSBUU1RfQ0dST1VQX1YxKSB7CisJCWNncm91cF9maWxlX2FkZCgm
Y2dnLT5wcm9jcywgInRhc2tzIiwgdHJlZSk7CisJCWNncm91cF9maWxlX2FkZCgmY2dnLT5jbG9u
ZV9jaGlsZHJlbiwgImNsb25lX2NoaWxkcmVuIiwgdHJlZSk7CisJCXJldHVybjsKKwl9CiAKLQlj
Z3JvdXBfbmV3X2RpciA9IHRzdF9jZ3JvdXBfZ2V0X3BhdGgoY2dyb3VwX2Rpcik7Ci0Jc3ByaW50
Zihrbm9iX3BhdGgsICIlcy8lcyIsIGNncm91cF9uZXdfZGlyLCBrbm9iKTsKLQlTQUZFX0ZJTEVf
UFJJTlRGKGtub2JfcGF0aCwgIiVsZCIsIHZhbHVlKTsKKwljZ3JvdXBfZmlsZV9hZGQoJmNnZy0+
cHJvY3MsICJjZ3JvdXAucHJvY3MiLCB0cmVlKTsKKwljZ3JvdXBfZmlsZV9hZGQoJmNnZy0+c3Vi
dHJlZV9jb250cm9sLCAiY2dyb3VwLnN1YnRyZWVfY29udHJvbCIsIHRyZWUpOwogfQogCi12b2lk
IHRzdF9jZ3JvdXBfbW92ZV9jdXJyZW50KGNvbnN0IGNoYXIgKmNncm91cF9kaXIpCitzdGF0aWMg
dm9pZCBjZ3JvdXBfaW5pdChzdHJ1Y3QgdHN0X2Nncm91cCAqY2cpCiB7Ci0JaWYgKHRzdF9jZ192
ZXIgJiBUU1RfQ0dST1VQX1YxKQotCQl0c3RfY2dyb3VwX3NldF9rbm9iKGNncm91cF9kaXIsICJ0
YXNrcyIsIGdldHBpZCgpKTsKKwljZy0+aXRlbSA9ICZjZ3JvdXBfZGVmYXVsdF9pdGVtOworCWNn
LT5uID0gMDsKIAotCWlmICh0c3RfY2dfdmVyICYgVFNUX0NHUk9VUF9WMikKLQkJdHN0X2Nncm91
cF9zZXRfa25vYihjZ3JvdXBfZGlyLCAiY2dyb3VwLnByb2NzIiwgZ2V0cGlkKCkpOworCWNncm91
cF9jZ3JvdXBfaW5pdCgmY2ctPmNncm91cCk7CisJY2dyb3VwX2NwdXNldF9pbml0KCZjZy0+Y3B1
c2V0KTsKKwljZ3JvdXBfbWVtb3J5X2luaXQoJmNnLT5tZW1vcnkpOwogfQogCi12b2lkIHRzdF9j
Z3JvdXBfbWVtX3NldF9tYXhieXRlcyhjb25zdCBjaGFyICpjZ3JvdXBfZGlyLCBsb25nIG1lbXN6
KQorc3RhdGljIHZvaWQgY2dyb3VwX2FkZChzdHJ1Y3QgdHN0X2Nncm91cCAqY2csIHN0cnVjdCB0
c3RfY2dyb3VwX3RyZWUgKnRyZWUpCiB7Ci0JaWYgKHRzdF9jZ192ZXIgJiBUU1RfQ0dST1VQX1Yx
KQotCQl0c3RfY2dyb3VwX3NldF9rbm9iKGNncm91cF9kaXIsICJtZW1vcnkubGltaXRfaW5fYnl0
ZXMiLCBtZW1zeik7CisJdWludDMyX3Qgc3NfZmllbGQgPSB0cmVlLT5zc19maWVsZDsKIAotCWlm
ICh0c3RfY2dfdmVyICYgVFNUX0NHUk9VUF9WMikKLQkJdHN0X2Nncm91cF9zZXRfa25vYihjZ3Jv
dXBfZGlyLCAibWVtb3J5Lm1heCIsIG1lbXN6KTsKKwljZy0+dHJlZXNbY2ctPm4rK10gPSB0cmVl
OworCWNncm91cF9jZ3JvdXBfYWRkKCZjZy0+Y2dyb3VwLCB0cmVlKTsKKworCWlmIChoYXNfY3Nz
KHNzX2ZpZWxkLCBUU1RfQ0dST1VQX01FTU9SWSkpCisJCWNncm91cF9tZW1vcnlfYWRkKCZjZy0+
bWVtb3J5LCB0cmVlKTsKKworCWlmIChoYXNfY3NzKHNzX2ZpZWxkLCBUU1RfQ0dST1VQX0NQVVNF
VCkpCisJCWNncm91cF9jcHVzZXRfYWRkKCZjZy0+Y3B1c2V0LCB0cmVlKTsKIH0KIAotaW50IHRz
dF9jZ3JvdXBfbWVtX3N3YXBhY2N0X2VuYWJsZWQoY29uc3QgY2hhciAqY2dyb3VwX2RpcikKK3N0
cnVjdCB0c3RfY2dyb3VwICp0c3RfY2dyb3VwX21rKGNvbnN0IHN0cnVjdCB0c3RfY2dyb3VwICpw
YXJlbnQsCisJCQkJIGNvbnN0IGNoYXIgKm5hbWUpCiB7Ci0JY2hhciAqY2dyb3VwX25ld19kaXI7
Ci0JY2hhciBrbm9iX3BhdGhbUEFUSF9NQVhdOworCXVuc2lnbmVkIGludCBpOworCXN0cnVjdCB0
c3RfY2dyb3VwICpjZzsKKwlzdHJ1Y3QgdHN0X2Nncm91cF90cmVlICp0cmVlOwogCi0JY2dyb3Vw
X25ld19kaXIgPSB0c3RfY2dyb3VwX2dldF9wYXRoKGNncm91cF9kaXIpOworCWlmICghcGFyZW50
LT5uKQorCQl0c3RfYnJrKFRCUk9LLCAiVHJ5aW5nIHRvIG1ha2UgQ0dyb3VwIGluIGVtcHR5IHBh
cmVudCIpOwogCi0JaWYgKHRzdF9jZ192ZXIgJiBUU1RfQ0dST1VQX1YxKSB7Ci0JCXNwcmludGYo
a25vYl9wYXRoLCAiJXMvJXMiLAotCQkJCWNncm91cF9uZXdfZGlyLCAiL21lbW9yeS5tZW1zdy5s
aW1pdF9pbl9ieXRlcyIpOworCWNnID0gU0FGRV9NQUxMT0Moc2l6ZW9mKCpjZykpOworCWNncm91
cF9pbml0KGNnKTsKIAotCQlpZiAoKGFjY2Vzcyhrbm9iX3BhdGgsIEZfT0spID09IC0xKSkgewot
CQkJaWYgKGVycm5vID09IEVOT0VOVCkKLQkJCQl0c3RfcmVzKFRDT05GLCAibWVtY2cgc3dhcCBh
Y2NvdW50aW5nIGlzIGRpc2FibGVkIik7Ci0JCQllbHNlCi0JCQkJdHN0X2JyayhUQlJPSyB8IFRF
UlJOTywgImZhaWxlZCB0byBhY2Nlc3MgJXMiLCBrbm9iX3BhdGgpOwotCQl9IGVsc2UgewotCQkJ
cmV0dXJuIDE7Ci0JCX0KKwlmb3IgKGkgPSAwOyBpIDwgcGFyZW50LT5uOyBpKyspIHsKKwkJdHJl
ZSA9IFNBRkVfTUFMTE9DKHNpemVvZigqdHJlZSkpOworCQl0c3RfY2dyb3VwX3RyZWVfbWsocGFy
ZW50LT50cmVlc1tpXSwgbmFtZSwgdHJlZSk7CisJCWNncm91cF9hZGQoY2csIHRyZWUpOwogCX0K
IAotCWlmICh0c3RfY2dfdmVyICYgVFNUX0NHUk9VUF9WMikgewotCQlzcHJpbnRmKGtub2JfcGF0
aCwgIiVzLyVzIiwKLQkJCQljZ3JvdXBfbmV3X2RpciwgIi9tZW1vcnkuc3dhcC5tYXgiKTsKKwly
ZXR1cm4gY2c7Cit9CiAKLQkJaWYgKChhY2Nlc3Moa25vYl9wYXRoLCBGX09LKSA9PSAtMSkpIHsK
LQkJCWlmIChlcnJubyA9PSBFTk9FTlQpCi0JCQkJdHN0X3JlcyhUQ09ORiwgIm1lbWNnIHN3YXAg
YWNjb3VudGluZyBpcyBkaXNhYmxlZCIpOwotCQkJZWxzZQotCQkJCXRzdF9icmsoVEJST0sgfCBU
RVJSTk8sICJmYWlsZWQgdG8gYWNjZXNzICVzIiwga25vYl9wYXRoKTsKLQkJfSBlbHNlIHsKLQkJ
CXJldHVybiAxOwotCQl9CitzdHJ1Y3QgdHN0X2Nncm91cCAqdHN0X2Nncm91cF9ybShzdHJ1Y3Qg
dHN0X2Nncm91cCAqY2cpCit7CisJdW5zaWduZWQgaW50IGk7CisKKwlmb3IgKGkgPSAwOyBpIDwg
Y2ctPm47IGkrKykgeworCQljbG9zZShjZy0+dHJlZXNbaV0tPmRpcik7CisJCVNBRkVfVU5MSU5L
QVQoY2ctPnRyZWVzW2ldLT5sb2MudHJlZS0+ZGlyLAorCQkJICAgICAgY2ctPnRyZWVzW2ldLT5s
b2MubmFtZSwKKwkJCSAgICAgIEFUX1JFTU9WRURJUik7CisJCWZyZWUoY2ctPnRyZWVzW2ldKTsK
IAl9CiAKLQlyZXR1cm4gMDsKKwlmcmVlKGNnKTsKKwlyZXR1cm4gTlVMTDsKIH0KIAotdm9pZCB0
c3RfY2dyb3VwX21lbV9zZXRfbWF4c3dhcChjb25zdCBjaGFyICpjZ3JvdXBfZGlyLCBsb25nIG1l
bXN6KQorc3RhdGljIHN0cnVjdCB0c3RfY2dyb3VwICpjZ3JvdXBfZnJvbV9yb290cyhzaXplX3Qg
dHJlZV9vZmYpCiB7Ci0JaWYgKHRzdF9jZ192ZXIgJiBUU1RfQ0dST1VQX1YxKQotCQl0c3RfY2dy
b3VwX3NldF9rbm9iKGNncm91cF9kaXIsICJtZW1vcnkubWVtc3cubGltaXRfaW5fYnl0ZXMiLCBt
ZW1zeik7CisJc3RydWN0IGNncm91cF9yb290ICpyOworCXN0cnVjdCB0c3RfY2dyb3VwX3RyZWUg
KnQ7CisJc3RydWN0IHRzdF9jZ3JvdXAgKmNnOworCisJY2cgPSB0c3RfYWxsb2Moc2l6ZW9mKCpj
ZykpOworCWNncm91cF9pbml0KGNnKTsKKworCWZvcl9lYWNoX3Jvb3QocikgeworCQl0ID0gKHR5
cGVvZih0KSkoKChjaGFyICopcikgKyB0cmVlX29mZik7CisKKwkJaWYgKHQtPnNzX2ZpZWxkKQor
CQkJY2dyb3VwX2FkZChjZywgdCk7CisJfQogCi0JaWYgKHRzdF9jZ192ZXIgJiBUU1RfQ0dST1VQ
X1YyKQotCQl0c3RfY2dyb3VwX3NldF9rbm9iKGNncm91cF9kaXIsICJtZW1vcnkuc3dhcC5tYXgi
LCBtZW1zeik7CisJaWYgKGNnLT5uKQorCQlyZXR1cm4gY2c7CisKKwl0c3RfYnJrKFRCUk9LLAor
CQkiTm8gQ0dyb3VwcyBmb3VuZDsgbWF5YmUgeW91IGZvcmdvdCB0byBjYWxsIHRzdF9jZ3JvdXBf
cmVxdWlyZT8iKTsKKworCXJldHVybiBjZzsKIH0KIAotdm9pZCB0c3RfY2dyb3VwX2NwdXNldF9y
ZWFkX2ZpbGVzKGNvbnN0IGNoYXIgKmNncm91cF9kaXIsIGNvbnN0IGNoYXIgKmZpbGVuYW1lLAot
CWNoYXIgKnJldGJ1Ziwgc2l6ZV90IHJldGJ1Zl9zeikKK2NvbnN0IHN0cnVjdCB0c3RfY2dyb3Vw
ICp0c3RfY2dyb3VwX2dldF9kZWZhdWx0KHZvaWQpCiB7Ci0JaW50IGZkOwotCWNoYXIgKmNncm91
cF9uZXdfZGlyOwotCWNoYXIga25vYl9wYXRoW1BBVEhfTUFYXTsKKwlyZXR1cm4gY2dyb3VwX2Zy
b21fcm9vdHMob2Zmc2V0b2Yoc3RydWN0IGNncm91cF9yb290LCB0ZXN0KSk7Cit9CiAKLQljZ3Jv
dXBfbmV3X2RpciA9IHRzdF9jZ3JvdXBfZ2V0X3BhdGgoY2dyb3VwX2Rpcik7Citjb25zdCBzdHJ1
Y3QgdHN0X2Nncm91cCAqdHN0X2Nncm91cF9nZXRfZHJhaW4odm9pZCkKK3sKKwlyZXR1cm4gY2dy
b3VwX2Zyb21fcm9vdHMob2Zmc2V0b2Yoc3RydWN0IGNncm91cF9yb290LCBkcmFpbikpOworfQog
Ci0JLyoKLQkgKiB0cnkgZWl0aGVyICcvZGV2L2NwdXNldC9YWFhYJyBvciAnL2Rldi9jcHVzZXQv
Y3B1c2V0LlhYWFgnCi0JICogcGxlYXNlIHNlZSBEb2N1bWVudGF0aW9uL2Nncm91cHMvY3B1c2V0
cy50eHQgZnJvbSBrZXJuZWwgc3JjCi0JICogZm9yIGRldGFpbHMKLQkgKi8KLQlzcHJpbnRmKGtu
b2JfcGF0aCwgIiVzLyVzIiwgY2dyb3VwX25ld19kaXIsIGZpbGVuYW1lKTsKLQlmZCA9IG9wZW4o
a25vYl9wYXRoLCBPX1JET05MWSk7Ci0JaWYgKGZkID09IC0xKSB7Ci0JCWlmIChlcnJubyA9PSBF
Tk9FTlQpIHsKLQkJCXNwcmludGYoa25vYl9wYXRoLCAiJXMvY3B1c2V0LiVzIiwKLQkJCQkJY2dy
b3VwX25ld19kaXIsIGZpbGVuYW1lKTsKLQkJCWZkID0gU0FGRV9PUEVOKGtub2JfcGF0aCwgT19S
RE9OTFkpOwotCQl9IGVsc2UKLQkJCXRzdF9icmsoVEJST0sgfCBURVJSTk8sICJvcGVuICVzIiwg
a25vYl9wYXRoKTsKK3N0YXRpYyB2b2lkIGNncm91cF9maWxlX3BvcHVsYXRlZChjb25zdCBjaGFy
ICpmaWxlLCBjb25zdCBpbnQgbGluZW5vLAorCQkJCSAgY29uc3Qgc3RydWN0IHRzdF9jZ3JvdXBf
ZmlsZSAqY2dmKQoreworCWlmIChjZ2YtPm4pCisJCXJldHVybjsKKworCXRzdF9icmtfKGZpbGUs
IGxpbmVubywgVEJST0ssCisJCSAiQ0dyb3VwIGl0ZW0gbm90IHBvcHVsYXRlZC4gTWF5YmUgbWlz
c2luZyB0c3RfY2dyb3VwX3JlcXVpcmUoKSBvciBUU1RfQ0dST1VQX0hBUygpIik7Cit9CisKK3Nz
aXplX3Qgc2FmZV9jZ3JvdXBfcmVhZChjb25zdCBjaGFyICpmaWxlLCBjb25zdCBpbnQgbGluZW5v
LAorCQkJIGNvbnN0IHN0cnVjdCB0c3RfY2dyb3VwX2ZpbGUgKmNnZiwKKwkJCSBjaGFyICpvdXQs
IHNpemVfdCBsZW4pCit7CisJdW5zaWduZWQgaW50IGk7CisJc2l6ZV90IG1pbl9sZW47CisJY29u
c3Qgc3RydWN0IHRzdF9jZ3JvdXBfbG9jYXRpb24gKmxvYyA9IGNnZi0+bG9jYXRpb25zOworCWNo
YXIgYnVmW0JVRlNJWl07CisKKwljZ3JvdXBfZmlsZV9wb3B1bGF0ZWQoZmlsZSwgbGluZW5vLCBj
Z2YpOworCisJZm9yIChpID0gMDsgaSA8IGNnZi0+bjsgaSsrKSB7CisJCVRFU1Qoc2FmZV9maWxl
X3JlYWRhdChmaWxlLCBsaW5lbm8sCisJCQkJICAgICAgbG9jW2ldLnRyZWUtPmRpciwgbG9jW2ld
Lm5hbWUsIG91dCwgbGVuKSk7CisJCWlmIChUU1RfUkVUIDwgMCkKKwkJCWNvbnRpbnVlOworCisJ
CW1pbl9sZW4gPSBNSU4oc2l6ZW9mKGJ1ZiksIChzaXplX3QpVFNUX1JFVCk7CisKKwkJaWYgKGkg
PiAwICYmIG1lbWNtcChvdXQsIGJ1ZiwgbWluX2xlbikpIHsKKwkJCXRzdF9icmtfKGZpbGUsIGxp
bmVubywgVEJST0ssCisJCQkJICIlcyBoYXMgZGlmZmVyZW50IHZhbHVlIGFjcm9zcyByb290cyIs
CisJCQkJIGxvY1tpXS5uYW1lKTsKKwkJCWJyZWFrOworCQl9CisKKwkJaWYgKGkgPj0gY2dmLT5u
KQorCQkJYnJlYWs7CisKKwkJbWVtY3B5KGJ1Ziwgb3V0LCBtaW5fbGVuKTsKIAl9CiAKLQltZW1z
ZXQocmV0YnVmLCAwLCByZXRidWZfc3opOwotCWlmIChyZWFkKGZkLCByZXRidWYsIHJldGJ1Zl9z
eikgPCAwKQotCQl0c3RfYnJrKFRCUk9LIHwgVEVSUk5PLCAicmVhZCAlcyIsIGtub2JfcGF0aCk7
CisJb3V0W01BWChUU1RfUkVULCAwKV0gPSAnXDAnOwogCi0JY2xvc2UoZmQpOworCXJldHVybiBU
U1RfUkVUOwogfQogCi12b2lkIHRzdF9jZ3JvdXBfY3B1c2V0X3dyaXRlX2ZpbGVzKGNvbnN0IGNo
YXIgKmNncm91cF9kaXIsIGNvbnN0IGNoYXIgKmZpbGVuYW1lLCBjb25zdCBjaGFyICpidWYpCit2
b2lkIHNhZmVfY2dyb3VwX3ByaW50Zihjb25zdCBjaGFyICpmaWxlLCBjb25zdCBpbnQgbGluZW5v
LAorCQkJY29uc3Qgc3RydWN0IHRzdF9jZ3JvdXBfZmlsZSAqY2dmLAorCQkJY29uc3QgY2hhciAq
Zm10LCAuLi4pCiB7Ci0JaW50IGZkOwotCWNoYXIgKmNncm91cF9uZXdfZGlyOwotCWNoYXIga25v
Yl9wYXRoW1BBVEhfTUFYXTsKKwl1bnNpZ25lZCBpbnQgaTsKKwljb25zdCBzdHJ1Y3QgdHN0X2Nn
cm91cF9sb2NhdGlvbiAqbG9jID0gY2dmLT5sb2NhdGlvbnM7CisJdmFfbGlzdCB2YTsKIAotCWNn
cm91cF9uZXdfZGlyID0gdHN0X2Nncm91cF9nZXRfcGF0aChjZ3JvdXBfZGlyKTsKKwljZ3JvdXBf
ZmlsZV9wb3B1bGF0ZWQoZmlsZSwgbGluZW5vLCBjZ2YpOwogCi0JLyoKLQkgKiB0cnkgZWl0aGVy
ICcvZGV2L2NwdXNldC9YWFhYJyBvciAnL2Rldi9jcHVzZXQvY3B1c2V0LlhYWFgnCi0JICogcGxl
YXNlIHNlZSBEb2N1bWVudGF0aW9uL2Nncm91cHMvY3B1c2V0cy50eHQgZnJvbSBrZXJuZWwgc3Jj
Ci0JICogZm9yIGRldGFpbHMKLQkgKi8KLQlzcHJpbnRmKGtub2JfcGF0aCwgIiVzLyVzIiwgY2dy
b3VwX25ld19kaXIsIGZpbGVuYW1lKTsKLQlmZCA9IG9wZW4oa25vYl9wYXRoLCBPX1dST05MWSk7
Ci0JaWYgKGZkID09IC0xKSB7Ci0JCWlmIChlcnJubyA9PSBFTk9FTlQpIHsKLQkJCXNwcmludGYo
a25vYl9wYXRoLCAiJXMvY3B1c2V0LiVzIiwgY2dyb3VwX25ld19kaXIsIGZpbGVuYW1lKTsKLQkJ
CWZkID0gU0FGRV9PUEVOKGtub2JfcGF0aCwgT19XUk9OTFkpOwotCQl9IGVsc2UKLQkJCXRzdF9i
cmsoVEJST0sgfCBURVJSTk8sICJvcGVuICVzIiwga25vYl9wYXRoKTsKKwlmb3IgKGkgPSAwOyBp
IDwgY2dmLT5uOyBpKyspIHsKKwkJdmFfc3RhcnQodmEsIGZtdCk7CisJCXNhZmVfZmlsZV92cHJp
bnRmYXQoZmlsZSwgbGluZW5vLAorCQkJCSAgICBsb2NbaV0udHJlZS0+ZGlyLCBsb2NbaV0ubmFt
ZSwgZm10LCB2YSk7CisJCXZhX2VuZCh2YSk7CiAJfQorfQogCi0JU0FGRV9XUklURSgxLCBmZCwg
YnVmLCBzdHJsZW4oYnVmKSk7Cit2b2lkIHNhZmVfY2dyb3VwX3NjYW5mKGNvbnN0IGNoYXIgKmZp
bGUsIGNvbnN0IGludCBsaW5lbm8sCisJCSAgICAgICBjb25zdCBzdHJ1Y3QgdHN0X2Nncm91cF9m
aWxlICpjZ2YsCisJCSAgICAgICBjb25zdCBjaGFyICpmbXQsIC4uLikKK3sKKwl2YV9saXN0IHZh
OworCWNoYXIgYnVmW0JVRlNJWl07CisJY29uc3Qgc3RydWN0IHRzdF9jZ3JvdXBfbG9jYXRpb24g
KmxvYzsKKwlzc2l6ZV90IGxlbiA9IHNhZmVfY2dyb3VwX3JlYWQoZmlsZSwgbGluZW5vLCBjZ2Ys
IGJ1Ziwgc2l6ZW9mKGJ1ZikpOworCisJaWYgKGxlbiA8IDEpCisJCXJldHVybjsKIAotCWNsb3Nl
KGZkKTsKKwl2YV9zdGFydCh2YSwgZm10KTsKKwlpZiAodnNzY2FuZihidWYsIGZtdCwgdmEpIDwg
MSkgeworCQlsb2MgPSBjZ2YtPmxvY2F0aW9uczsKKwkJdHN0X2Jya18oZmlsZSwgbGluZW5vLCBU
QlJPSyB8IFRFUlJOTywKKwkJCSAiJyVzLyVzJzogdnNzY2FuZignJXMnLCAnJXMnLCAuLi4pIiwK
KwkJCSB0c3RfZGVjb2RlX2ZkKGxvYy0+dHJlZS0+ZGlyKSwgbG9jLT5uYW1lLCBidWYsIGZtdCk7
CisJfQorCXZhX2VuZCh2YSk7CiB9Ci0tIAoyLjMwLjAKCgotLSAKTWFpbGluZyBsaXN0IGluZm86
IGh0dHBzOi8vbGlzdHMubGludXguaXQvbGlzdGluZm8vbHRwCg==
